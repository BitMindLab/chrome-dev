var PIAO = PIAO || {};

function openPage(a, c, e) {
    var d = null;
    "string" === typeof c && c.length && (document.createElement("img").src = c + "?_" + Math.random());
    (function(a) {
        chrome.windows.getLastFocused(function(b) {
            chrome.tabs.getAllInWindow(b.id, function(b) {
                a(b)
            })
        })
    })(function(g) {
        for (var b = 0; b < g.length; b++) {
            var c = g[b];
            if (c.url === a) {
                (function(b) {
                    chrome.tabs.getSelected(null, function(c) {
                        c.url === a ? e || chrome.tabs.reload(c.id, {}, function() {}) : (chrome.tabs.update(b.id, {
                            selected: !0
                        }), chrome.windows.update(b.windowId, {
                            focused: !0
                        }))
                    })
                })(c);
                return
            }
            "chrome://newtab/" ===
            c.url && (d = c)
        }
        d ? (chrome.tabs.update(d.id, {
            url: a,
            selected: !0
        }), chrome.windows.update(c.windowId, {
            focused: !0
        })) : chrome.windows.getLastFocused(function(b) {
            chrome.tabs.create({
                windowId: b.id,
                url: a
            }, function(b) {
                chrome.windows.update(b.windowId, {
                    focused: !0
                })
            })
        })
    })
}

function openMyOrder(a) {
    function c(d, g, b) {
        console.log(d, g, b);
        d === e.id && "complete" === g.status && (chrome.tabs.onUpdated.removeListener(c), sendMessage({
            type: "myOrder",
            url: a
        }, function() {}, d))
    }
    var e = null;
    chrome.tabs.create({
        url: "http://www.12306.cn/mormhweb/kyfw/",
        selected: !0
    }, function(a) {
        e = a;
        chrome.tabs.onUpdated.addListener(c)
    })
}

function dateTimeFormat(a) {
    var c = a.getFullYear(),
        e = a.getMonth() + 1,
        d = a.getDate(),
        e = 9 >= e ? "0" + String(e) : String(e),
        d = 9 >= d ? "0" + String(d) : String(d);
    return String(c) + "-" + e + "-" + d + " " + a.toLocaleTimeString()
}
var audio = null;

function audioPlay() {
    if (!audio || audio.paused) audio = new Audio("../song.ogg"), audio.loop = !0, audio.play()
}

function audioStop() {
    audio && !audio.paused && (audio.pause(), audio = null)
}
var needStopAudio = !0;

function cancelNotify() {
    null !== PIAO.notification && ("function" == typeof PIAO.notification.cancel ? PIAO.notification.cancel() : "function" == typeof PIAO.notification.close && PIAO.notification.close(), PIAO.notification = null, needStopAudio = !1, audioStop())
}

function createNotify(a) {
    var c = {};
    window.Notification ? c = new Notification("", {
        icon: PIAO.iconUrl,
        body: dateTimeFormat(new Date) + "\n" + a.msg
    }) : webkitNotifications && "function" == typeof webkitNotifications.createNotification && (c = webkitNotifications.createNotification(PIAO.iconUrl, dateTimeFormat(new Date), a.msg), c.show());
    return c
}

function singleNotify(a) {
    cancelNotify();
    PIAO.notification = createNotify(a);
    PIAO.notification.onclose = function() {
        needStopAudio ? (PIAO.notification = null, audioStop()) : needStopAudio = !0
    };
    PIAO.notification.onclick = function() {
        PIAO.notification.onclose(); - 1 != a.tabId && chrome.tabs.update(a.tabId, {
            selected: !0
        })
    };
    a.audioPlay && audioPlay()
}

function notify(a) {
    "create" === a.method ? singleNotify(a) : cancelNotify()
}

function isCertInstalled() {
    var a = !1;
    PIAO.plugin && PIAO.plugin.IsInstalled && (a = PIAO.plugin.IsInstalled());
    "string" === typeof a && (PIAO.codec.length || (PIAO.codec = a), a = !0);
    return a
}

function openUrl(a) {
    void 0 !== a && chrome.tabs.getSelected(void 0, function(c) {
        c && c.url && !c.incognito && 0 === c.url.indexOf("chrome://newtab") ? chrome.tabs.update(c.id, {
            url: a
        }) : chrome.tabs.create({
            url: a
        })
    })
}

function installCert() {
    var a = !1;
    PIAO.plugin && PIAO.plugin.Install && (a = PIAO.plugin.Install());
    return a
}

function getShareType() {
    var a = 0;
    PIAO.plugin && PIAO.plugin.Install && (a = PIAO.plugin.GetType(), PIAO.stype || (PIAO.stype = a));
    return a
}

function getMySig(a) {
    var c = "";
    if ("string" !== typeof a || 0 == a.length) return c;
    PIAO.plugin && PIAO.plugin.GetSig && (c = PIAO.plugin.GetSig(a));
    return c
}

function switchcdn() {
    var a = !1;
    if (!0 !== serverConfig.switchdns) return a;
    !0 == PIAO.can_switch && (!1 == PIAO.switch_config_download && (setTimeout(function() {
        chrome.management.downloadHostMapRule()
    }, 100), PIAO.switch_config_download = !0), setTimeout(function() {
        chrome.management.switchHostDNSRand()
    }, 1E4), a = !0);
    return a
}
(function() {
    localStorage.notification_array = void 0 !== localStorage.notification_array ? localStorage.notification_array : "[]";
    window.addEventListener("load", function() {
        var a = (new Date).toLocaleDateString();
        localStorage.stat_date != a && (localStorage.stat_date = a, document.createElement("img").src = "http://dd.browser.360.cn/static/a/26.310.gif?_" + Math.random());
        PIAO.plugin = document.getElementById("pluginId");
        chrome.browserAction.setIcon({
            path: "images/19.png"
        });
        TicketPlugin.init(PIAO.plugin);
        PIAO.iconUrl = chrome.extension.getURL("images/12306.png");
        PIAO.title = chrome.i18n.getMessage("name");
        PIAO.notification = null;
        PIAO.codec = "";
        setTimeout(function() {
            isCertInstalled();
            getShareType()
        }, 1E3);
        chrome.management.downloadHostMapRule && chrome.management.switchHostDNSRand && (PIAO.switch_config_download = !1, PIAO.can_switch = !0);
        chrome.management.get("jaojfpnikjjobngdfbgbhflfooidihmg", function(a) {
            PIAO.version = a && a.version ? a.version : "1000.1000.1000.1000";
            a = !0;
            "true" !== localStorage[PIAO.version] && (localStorage[PIAO.version] = !0);
            "true" !== localStorage.has_dotted &&
                (a = localStorage.has_dotted = !0, document.createElement("img").src = "http://dd.browser.360.cn/static/a/26.7063.gif?_" + Math.random());
            "true" !== localStorage.has_installCert && (localStorage.has_installCert = !0, installCert());
            Utils.updateRefresh(a)
        })
    }, !1);
    window.onload = function() {
        "function" == typeof chrome.management.setIncognitoEnabled && chrome.management.setIncognitoEnabled(chrome.app.getDetails().id, !0)
    };
    console.log = function() {}
})();
var TicketCookie = TicketCookie || {};
(function(a) {})(TicketCookie);
Object.preventExtensions(TicketCookie);
var TicketCaptcha = TicketCaptcha || {};
(function(a) {
    a.getCaptcha = function(a, e, d) {
        var g = getMySig(a);
        Utils.getCookie({
            domain: "kyfw.12306.cn",
            name: "current_captcha_type"
        }, function(b) {
            b = parseInt(serverConfig.captchaTimeout);
            1E3 <= b && 3E3 >= b || (b = 2500);
            $.ajax({
                url: "http://check.huochepiao.360.cn/img_vcode",
                type: "post",
                timeout: b,
                data: JSON.stringify({
                    img_buf: a,
                    type: "D",
                    logon: "submit" == e.module ? 0 : 1,
                    check: g
                })
            }).done(function(a) {
                try {
                    var b = JSON.parse(a);
                    a = "";
                    "string" === typeof b.res && (a = b.res);
                    d(a)
                } catch (g) {
                    d("")
                }
            })
        })
    }
})(TicketCaptcha);
Object.preventExtensions(TicketCaptcha);
var TicketCross = TicketCross || {};
(function(a) {
    function c(a, c, g) {
        switch (a.type) {
            case "pageNotify":
                a.notifyInfo.tabId = (c.tab || {}).id || -1;
                notify(a.notifyInfo, g);
                break;
            case "getBackgroundInfo":
                g({
                    ipAble: void 0 !== chrome.account360,
                    extInfo: chrome.app.getDetails()
                })
        }
        return !0
    }
    "undefined" !== typeof chrome.extension.onMessage && chrome.extension.onMessage.addListener ? chrome.extension.onMessage.addListener(c) : "undefined" !== typeof chrome.extension.onRequest && chrome.extension.onRequest.addListener && chrome.extension.onRequest.addListener(c);
    a.xhr =
        function(a, c) {
            c(a)
        }
})(TicketCross);
Object.preventExtensions(TicketCross);
var serverUrl = "http://api.lxqp.360.cn/config/piao_crx.js",
    serverConfig = {
        checkInterval: 18E4,
        captchaTimeout: 2500,
        promote: {
            date: "",
            url: ""
        },
        newCheck: !1,
        injectTuipiao: !1,
        switchdns: !1,
        dynamic: !1,
        noyun: !1,
        remarkResult: !1,
        checkUrls: [],
        popupList_newui: [],
        bubbleTipsConfig: [],
        payfinishShare: {}
    },
    blockThirdPartyCookies = !1;
(function() {
    function a(a, b) {
        "object" === typeof a && "string" === typeof b && b.length && a.hasOwnProperty(b) && localStorage[b] && (a[b] = "true" === (localStorage[b] || "false").toString())
    }

    function c(a) {
        var b = serverUrl + "?_" + Math.random();
        Utils.xhr(null, b, "GET", function(b, c, d) {
            try {
                var m = JSON.parse(b),
                    h;
                for (h in m)
                    if (m.hasOwnProperty(h) && serverConfig.hasOwnProperty(h) && m[h] != serverConfig[h])
                        if ("remarkResult" === h || "switchdns" === h || "dynamic" === h || "noyun" === h || "newCheck" === h) {
                            if (serverConfig[h] = m[h] ? !0 : !1, "switchdns" ===
                                h || "dynamic" === h || "noyun" === h) localStorage[h] = serverConfig[h]
                        } else "checkInterval" === h ? "number" === typeof serverConfig[h] && (serverConfig[h] = m[h]) : serverConfig[h] = m[h];
                var n = +new Date(d.getResponseHeader("Date") || +new Date);
                e(serverConfig.bubbleTipsConfig, n);
                sendMessage({
                    type: "updateServerConfig",
                    config: serverConfig
                }, function() {}, null);
                "function" === typeof a && a(serverConfig)
            } catch (p) {}
        });
        setTimeout(function() {
            c()
        }, +serverConfig.checkInterval)
    }

    function e(a, b) {
        var c = parseInt(localStorage.server_nofity_version) ||
            0;
        a.every(function(a) {
            return Date.parse(a.time) < b && a.version > c ? (localStorage.server_nofity_version = a.version, (new Notification("", {
                icon: a.icon,
                body: a.text
            })).onclick = function() {
                openPage(a.url);
                this.close()
            }, !1) : !0
        })
    }
    var d = {};
    a(serverConfig, "switchdns");
    a(serverConfig, "dynamic");
    a(serverConfig, "noyun");
    c(function(a) {
        var b = a.promote.date;
        if ((a = a.promote.url) && b) {
            var c = /(?:https|http):\/\/.[\S]*\.360\.cn\/[\S]*/;
            try {
                if ("string" !== typeof b || 10 != b.length || !a.match(c)) return
            } catch (d) {}
            var e = new Date,
                c =
                e.getFullYear(),
                m = e.getMonth() + 1,
                e = e.getDate(),
                e = String(c) + (10 > m ? "-0" : "-") + m + (10 > e ? "-0" : "-") + e;
            e === b && "true" !== localStorage[b] && (localStorage[b] = !0, openPage(a))
        }
    });
    chrome.webRequest.onErrorOccurred.addListener(function(a) {
        console.log(a);
        var b = "NET::ERR_INSECURE_RESPONSE" === a.error.toUpperCase(),
            c = a.tabId;
        a = a.type;
        b && chrome.tabs.sendMessage(c, {
            type: "error501",
            error: b,
            tabId: c,
            docType: a
        }, function() {})
    }, {
        urls: ["*://*.12306.cn/otsweb/*"]
    });
    chrome.webRequest.onBeforeSendHeaders.addListener(function(a) {
        for (var b =
                /127\.0\.0\.1|pc\.huochepiao\.360\.cn|lxqp\.360\.cn|huijia\.corp\.qihoo\.net/, c = "https://kyfw.12306.cn", c = a.url.match(/^http:/) ? c.replace(/^https:/, "http:") : c, f = 0; f < a.requestHeaders.length; ++f)
            if ("Referer" === a.requestHeaders[f].name) {
                a.requestHeaders[f].value.match(b) && (a.requestHeaders[f].value = c + "/otn/leftTicket/init");
                for (var e in d) e == a.url && (a.requestHeaders[f].value = d[e], delete d[e])
            } else "Origin" === a.requestHeaders[f].name && a.requestHeaders[f].value.match(b) && (a.requestHeaders[f].value = c);
        if (-1 <
            a.url.indexOf("/otn/passcodeNew/checkRandCodeAnsyn")) {
            b = !1;
            for (f = 0; f < a.requestHeaders.length; f++)
                if ("Cookie" == a.requestHeaders[f].name) {
                    b = !0;
                    break
                }
            blockThirdPartyCookies = !b
        }
        a.url.match(/([0-9]{1,3}\.{1}){3}[0-9]{1,3}/) && a.requestHeaders.push({
            name: "Host",
            value: "kyfw.12306.cn"
        });
        return {
            requestHeaders: a.requestHeaders
        }
    }, {
        urls: ["*://*/otn/*", "*://*/passport/*"]
    }, ["blocking", "requestHeaders"]);
    chrome.webRequest.onBeforeRequest.addListener(function(a) {
        a = a.url;
        var b = a.match(/[?&]ref.to2=(.*?)(&|$)/i);
        if (b =
            b && b[1]) a = a.replace(/ref.to2=(.*?)(&|$)/i, ""), a = a.replace(/[?&]$/, ""), d[a] = b;
        return {
            redirectUrl: a
        }
    }, {
        urls: ["*://*/otn/*"]
    }, ["blocking"]);
    chrome.webRequest.onCompleted.addListener(function(a) {
        a.url.match(/otn\/queryOrder\/queryMyOrder/) && sendMessage({
            type: "onQueryOrderCompleted"
        }, function() {}, a.tabId)
    }, {
        urls: ["*://*/otn/*"]
    })
})();

function getAllTabs(a, c) {
    a ? c([{
        id: a
    }]) : chrome.tabs.query({}, function(a) {
        for (var d = [], g = /^https?:[\S]+/, b = 0; b < a.length; b++) {
            var l = a[b];
            l.url.match(g) && d.push(l)
        }
        c(d)
    })
}

function sendMessage(a, c, e) {
    getAllTabs(e, function(d) {
        for (var e = 0; e < d.length; e++) {
            var b = d[e].id;
            "function" === typeof chrome.tabs.sendMessage ? chrome.tabs.sendMessage(b, a, c) : "function" === typeof chrome.tabs.sendRequest && chrome.tabs.sendRequest(b, a, c)
        }
    })
}
(function() {
    function a(a, e, d) {
        switch (a.type) {
            case "checkUpdate":
                checkUpdate(d);
                break;
            case "getInitData":
                d({
                    stype: PIAO.stype
                });
                break;
            case "deleteCookies":
                deleteCookies(d);
                break;
            case "error501":
                d(installCert());
                break;
            case "toQuery":
                sendMessage({
                    type: "toQuery"
                }, function() {}, null);
                d();
                break;
            case "setLocalStorage":
                localStorage[a.key] = a.value;
                d({
                    key: a.key,
                    value: a.value
                });
                break;
            case "getLocalStorage":
                d({
                    key: a.key,
                    value: localStorage[a.key]
                });
                break;
            case "notify":
                notify(a.notifyInfo);
                if (a.notifyInfo && "create" ===
                    a.notifyInfo.method) TicketMonitor.onTargetTabChange(e.tab.id);
                break;
            case "openPage":
                openPage(a.url);
                break;
            case "getNotify":
                d(Notify.getNotify(a.stamp));
                break;
            case "getNotifyArray":
                d(Notify.notifyArray());
                break;
            case "createNotify":
                Notify.add(a.notify, d);
                break;
            case "removeNotify":
                Notify.remove(a.stamp);
                break;
            case "getNotifyMsg":
                d(Notify.curNotifyMsg);
                break;
            case "closeNotify":
                Notify.closeNotify();
                break;
            case "switchToPathPlan":
                sendMessage({
                    type: "switchToPathPlan"
                }, function() {}, e.tab.id);
                break;
            case "documentCLick":
                sendMessage({
                        type: "documentCLick"
                    },
                    function() {}, e.tab.id);
                break;
            case "getStatus":
                TicketConfig.getStatus(d);
                break;
            case "initQuery":
                TicketPlugin.curTabId = e.tab.id;
                TicketPlugin.needShow = !0;
                TicketPlugin.show();
                break;
            case "refreshStopped":
                TicketPlugin.refreshStopped(a.msgInfo);
                break;
            case "refreshStudentBtn":
                TicketPlugin.refreshStudentBtn(a.status);
                break;
            case "hidePanel":
                TicketPlugin.needShow = !1;
                TicketPlugin.close();
                break;
            case "refreshCount":
                TicketPlugin.refreshCount(a.value);
                break;
            case "refreshPassengers":
                d();
                TicketPlugin.refreshPassengers(a.passengers);
                break;
            case "getFrameOffset":
                (function(a, b) {
                    sendMessage({
                        type: "getFrameOffset"
                    }, function(b) {
                        console.log("^^^^^^^^^^^", b);
                        a(b)
                    }, b)
                })(d, e.tab.id);
                break;
            case "getServerConfig":
                d(serverConfig);
                break;
            case "virtualClick":
                TicketPlugin.virtualClick(a.rect);
                break;
            case "getCaptcha":
                TicketCaptcha.getCaptcha(a.data, a.options, d);
                break;
            case "switchcdn":
                switchcdn();
                break;
            case "getSig":
                d(getMySig(a.data));
                break;
            case "refresh12306Orders":
                sendMessage({
                    type: "onRefresh12306Orders"
                });
                break;
            case "ajax":
                a = a.settings;
                Utils.xhr(a.data,
                    a.url, a.method,
                    function(a, b) {
                        d({
                            data: a,
                            status: b
                        })
                    }, a.timeout);
                break;
            case "getBlockCookies":
                d(blockThirdPartyCookies);
                break;
            case "getCookie":
                Utils.getCookie(a.object, function(a) {
                    d({
                        cookies: a
                    })
                });
                break;
            case "setCookie":
                e = a.object.keyValues || [];
                var g = {};
                g.url = a.object.url;
                g.domain = a.object.domain;
                g.path = a.object.path;
                g.secure = a.object.secure;
                g.httpOnly = a.object.httpOnly;
                g.expirationDate = a.object.expirationDate;
                var b = 0;
                e.forEach(function(a) {
                    g.name = a.name;
                    g.value = a.value;
                    b++;
                    Utils.setCookie(g, function(a) {
                        0 >=
                            --b && d(a)
                    })
                });
                break;
            case "isIncognito":
                d((e.tab || {}).incognito || !1);
                break;
            case "openIncognito":
                !(e.tab || {}).incognito && chrome.windows.create({
                    url: a.url,
                    focused: !0,
                    incognito: !0,
                    top: 0,
                    left: 0,
                    width: window.screen.availWidth,
                    height: window.screen.availHeight
                }, d);
                break;
            case "getPIAOcodec":
                d(PIAO.codec)
        }
        return !0
    }
    sendMessage({
        type: "refresh"
    }, function() {}, null);
    "undefined" !== typeof chrome.extension.onMessage && chrome.extension.onMessage.addListener ? chrome.extension.onMessage.addListener(a) : "undefined" !== typeof chrome.extension.onRequest &&
        chrome.extension.onRequest.addListener && chrome.extension.onRequest.addListener(a)
})();
var TicketMonitor = TicketMonitor || {};
(function(a) {
    var c = /^https?:\/\/www\.12306\.cn\/mormhweb\/kyfw\/*/;
    chrome.tabs.onActivated.addListener(function(a) {
        chrome.tabs.get(a.tabId, function(a) {
            a.id === TicketPlugin.curTabId && a.url.match(c) && TicketPlugin.needShow ? TicketPlugin.show() : TicketPlugin.hide()
        })
    });
    chrome.tabs.onRemoved.addListener(function(a) {
        a === TicketPlugin.curTabId && TicketPlugin.close()
    });
    chrome.tabs.onUpdated.addListener(function(a, d, g) {
        a === TicketPlugin.curTabId && "loading" === d.status ? TicketPlugin.close() : "loading" === d.status && (!g.url.match(c) &&
            g.selected) && TicketPlugin.hide()
    });
    a.onTargetTabChange = function(a) {
        function d(c) {
            console.warn(c);
            c === a && (window.notify(b), chrome.tabs.onRemoved.removeListener(d))
        }

        function g(d, f, k) {
            console.warn(d, f, k);
            d !== a || ("loading" !== k.status || k.url.match(c)) || (window.notify(b), chrome.tabs.onUpdated.removeListener(g))
        }
        var b = {
            method: "cancel",
            audioPlay: !1,
            msg: ""
        };
        chrome.tabs.onRemoved.addListener(d);
        chrome.tabs.onUpdated.addListener(g)
    }
})(TicketMonitor);
var Notify = void 0 !== Notify ? Notify : {};
(function(a) {
    function c(b, c) {
        null !== k && (k && "function" == typeof k.cancel ? k.cancel() : k && "function" == typeof k.close && k.close(), k = null);
        setTimeout(function() {
            b.audioPlay && window.audioPlay()
        }, 500);
        a.curNotifyMsg = (c ? h : m).replace("XX", (new Date(+ +b.stamp)).pattern("yyyy-MM-dd"));
        if (c && +b.stamp < +new Date + 4 * l || !c && (+b.stamp < new Date(2016, 11, 30) ? +b.stamp - 59 * l : +b.stamp - 29 * l) + l < +new Date) a.curNotifyMsg = a.curNotifyMsg.replace("\u4eca\u5929", "\u5df2\u7ecf");
        window.Notification ? k = new Notification("", {
            icon: window.PIAO.iconUrl,
            body: a.curNotifyMsg
        }) : (k = webkitNotifications.createNotification(window.PIAO.iconUrl, "", a.curNotifyMsg), k.show());
        k.onclose = function() {
            window.audioStop();
            k = null
        };
        k.onclick = function() {
            a.closeNotify()
        }
    }

    function e() {
        if (0 !== f.length) {
            for (var a = +new Date, d = !1, e = 0; e < f.length; e++)(f[e].stamp < new Date(2016, 11, 30) ? f[e].stamp - 59 * l : f[e].stamp - 29 * l) <= a && (d = !0, f[e].stamp >= a + l && c(f[e], !1), sendMessage({
                type: "removeNotify",
                stamp: f[e].stamp
            }, function() {}, null), b(f[e].stamp), f.splice(e--, 1));
            d && (localStorage.notification_array =
                JSON.stringify(f))
        }
    }

    function d(a, b) {
        b = "undefined" !== typeof b ? b ? 1 : -1 : 1;
        return function(c, d) {
            var e = c[a],
                f = d[a];
            return e === f ? 0 : e > f ? b : -b
        }
    }

    function g(a) {
        for (var b = !1, c = 0; c < f.length; c++)
            if (console.log(+f[c].stamp, +a.stamp), +f[c].stamp === +a.stamp) {
                b = !0;
                break
            }
        return b
    }

    function b(a) {
        var b = chrome.extension.getViews({
            type: "popup"
        });
        console.warn(b);
        0 < b.length && "function" === typeof b[0].removeNotify && b[0].removeNotify(a)
    }
    var l = 864E5,
        f = JSON.parse(localStorage.notification_array || "[]");
    (function() {
        var a = [];
        void 0 !==
            localStorage.notify_array && (a = JSON.parse(localStorage.notify_array || "[]"));
        if (0 !== a.length) {
            for (var b = 0; b < a.length; b++) a[b].stamp += 19 * l, g(a[b]) || f.push(a[b]);
            delete localStorage.notify_array;
            f.sort(d("stamp", !0));
            localStorage.notification_array = JSON.stringify(f)
        }
    })();
    var k = null,
        m = "\u60a8\u9884\u8ba2\u7684XX\u7684\u706b\u8f66\u7968\u4eca\u5929\u5f00\u552e\uff0c\u8bf7\u5c3d\u5feb\u767b\u5f55\u7f51\u7ad9\u8d2d\u7968\u3002",
        h = "\u60a8\u9884\u8ba2\u7684XX\u7684\u706b\u8f66\u7968\u4eca\u5929\u5f00\u552e\u4e34\u5ba2\uff0c\u8bf7\u5c3d\u5feb\u767b\u5f55\u7f51\u7ad9\u8d2d\u7968\u3002";
    setInterval(function() {
        e()
    }, 1E4);
    Date.prototype.pattern = function(a) {
        var b = {
                "M+": this.getMonth() + 1,
                "d+": this.getDate(),
                "h+": this.getHours(),
                "H+": this.getHours(),
                "m+": this.getMinutes(),
                "s+": this.getSeconds(),
                "q+": Math.floor((this.getMonth() + 3) / 3),
                S: this.getMilliseconds()
            },
            c = {
                0: "\u65e5",
                1: "\u4e00",
                2: "\u4e8c",
                3: "\u4e09",
                4: "\u56db",
                5: "\u4e94",
                6: "\u516d"
            };
        /(y+)/.test(a) && (a = a.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length)));
        /(E+)/.test(a) && (a = a.replace(RegExp.$1, (1 < RegExp.$1.length ?
            2 < RegExp.$1.length ? "\u661f\u671f" : "\u5468" : "") + c[this.getDay() + ""]));
        for (var d in b) b.hasOwnProperty(d) && RegExp("(" + d + ")").test(a) && (a = a.replace(RegExp.$1, 1 === RegExp.$1.length ? b[d] : ("00" + b[d]).substr(("" + b[d]).length)));
        return a
    };
    a.curNotifyMsg = m;
    a.getNotify = function(a) {
        for (var b = null, c = 0; c < f.length; c++)
            if (+f[c].stamp === +a) {
                b = f[c];
                break
            }
        return b
    };
    a.notifyArray = function() {
        return f
    };
    a.closeNotify = function() {
        k && "function" == typeof k.cancel ? k.cancel() : k && "function" == typeof k.close && k.close();
        window.audioStop();
        k = null;
        openPage("http://pc.huochepiao.360.cn/?src=ext", "", !0)
    };
    a.remove = function(a) {
        for (var b = 0; b < f.length; b++) + f[b].stamp === +a && f.splice(b--, 1);
        localStorage.notification_array = JSON.stringify(f)
    };
    a.add = function(a, b) {
        var c = g(a);
        c || (f.push(a), f.sort(d("stamp", !0)), localStorage.notification_array = JSON.stringify(f));
        b(c)
    }
})(Notify);
Object.preventExtensions(Notify);
var TicketPlugin = TicketPlugin || {};
(function(a, c) {
    var e = {},
        d = !1,
        g = [];
    a.needShow = !1;
    a.curTabId = 0;
    a.init = function(a) {
        e = a
    };
    a.show = function() {
        Utils.getUserInfo(function(b) {
            console.log(b);
            chrome.tabs.getSelected(function(c) {
                console.log(c);
                a.curTabId === c.id && -1 !== c.url.indexOf("http://www.12306.cn/mormhweb/kyfw/") && e.Show(JSON.stringify(b), "")
            })
        })
    };
    a.hide = function() {
        console.log("hide.........")
    };
    a.close = function() {
        console.log("close.........");
        e.Close()
    };
    a.click = function(a) {
        console.log("click.........");
        e.Click(a)
    };
    a.statusChanged = function(a) {
        console.log("statusChanged.........");
        e.StatusChanged(a)
    };
    a.refreshStopped = function(a) {
        console.log("refreshStopped.........", a);
        e.RefreshStopped(JSON.stringify(a))
    };
    a.refreshPassengers = function(a) {
        console.log(a);
        e.SetPassagers(JSON.stringify({
            passengers: a
        }))
    };
    a.refreshCount = function(a) {
        console.log("refreshCount.........");
        e.RefreshCount(a.toString())
    };
    a.refreshStudentBtn = function(a) {
        console.log("refreshStudentBtn.........", a);
        e.EnableStudent(a)
    };
    a.virtualClick = function(a) {
        console.log("simulClick.........");
        e.VirtualClick(JSON.stringify(a));
        console.log("plugin simul click.........", a)
    };
    c.OnOptionChanged = function(a) {
        function c() {
            var a = JSON.parse(g.shift());
            sendMessage({
                type: "updateUserInfo",
                info: a
            }, function() {
                d = !1;
                0 < g.length && c()
            }, TicketPlugin.curTabId);
            setTimeout(function() {
                d = !1
            }, 1E3)
        }
        console.log(a);
        g.push(a);
        d || (d = !0, c())
    };
    c.OnCommandChanged = function(b) {
        console.log(b);
        b = JSON.parse(b);
        b = b.command;
        var c = b.name.toLowerCase(),
            d = "true" === b.value.toString();
        "close" === c ? (sendMessage({
                type: "refresh",
                isStart: !1
            }, function() {}, TicketPlugin.curTabId),
            a.close()) : "order" === c ? sendMessage({
            type: "order",
            trainInfo: b.value
        }, function() {}) : "openurl" === c ? (b = b.value.toString(), "1" === b ? openPage("http://www.12306.cn/mormhweb/zxdt/tlxw_tdbtz56.html") : "3" === b ? sendMessage({
            type: "addPassenger"
        }, function() {}) : "4" === b ? openPage("http://www.12306.cn/mormhweb/zxdt/tlxw_tdbtz56.html") : "5" === b && openPage("http://bbs.360safe.com/thread-3086169-1-1.html")) : "refreshpassengers" === c ? sendMessage({
            type: "refreshPassengers"
        }, function() {}) : sendMessage({
            type: "refresh" === c ? c : "studentRefresh",
            isStart: d
        }, function() {}, TicketPlugin.curTabId)
    }
})(TicketPlugin, window);
Object.preventExtensions(TicketPlugin);
var AJAX = AJAX || {};
(function(a) {
    a.isOffLine = function() {
        return !window.navigator.onLine
    };
    a.xhr = function(c, e, d, g) {
        function b() {
            4 === l.readyState && 200 === l.status && (f && (clearTimeout(f), f = null), g({
                errno: 0,
                errmsg: l.responseXML
            }))
        }
        if (a.isOffLine()) g({
            errno: -1,
            errmsg: "noupdate"
        });
        else {
            var l = new XMLHttpRequest,
                f = setTimeout(function() {
                    if (4 !== l.readyState || 200 !== l.status) l.abort(), g({
                        errno: -1,
                        errmsg: "noupdate"
                    })
                }, 3E3);
            l.onreadystatechange = b;
            l.open(d, e, !0);
            l.send(c)
        }
    }
})(AJAX);

function checkUpdate(a) {
    var c = "http://upext.chrome.360.cn/intf.php?method=ExtUpdate.query&x=id%3Djaojfpnikjjobngdfbgbhflfooidihmg%26v%3DVERSION%26uc";
    try {
        var e = localStorage.getItem("last_update_time") || "";
        6E4 > +new Date - (parseInt(e, 10) || 0) ? (void 0 === PIAO.updateInfo && (PIAO.updateInfo = {
            status: !1,
            version: PIAO.version,
            codebase: "",
            stype: PIAO.stype
        }), a(PIAO.updateInfo)) : localStorage.setItem("last_update_time", +new Date)
    } catch (d) {}
    chrome.management.get("jaojfpnikjjobngdfbgbhflfooidihmg", function(d) {
        var b =
            d && d.version ? d.version : "1000.1000.1000.1000";
        c = c.replace("VERSION", b);
        AJAX.xhr(null, c, "GET", function(c) {
            var d = {
                status: !1,
                version: b,
                codebase: "",
                stype: 0
            };
            0 === c.errno && (c = c.errmsg.getElementsByTagName("updatecheck"), c = 0 < c.length ? c[0] : {}, d.status = c.getAttribute("status") || d.status, d.version = c.getAttribute("version") || d.version, d.codebase = c.getAttribute("codebase") || d.codebase);
            d.status = "string" === typeof d.status && "ok" === d.status.toLowerCase();
            d.stype = window.getShareType();
            PIAO.updateInfo = d;
            a(d)
        })
    })
}

function deleteCookies(a) {
    function c(b) {
        chrome.cookies.getAll({
            url: b
        }, function(c) {
            var e = c.length,
                m = 0;
            g++;
            if (m >= e && g >= d) console.log(m, e, g, d), setTimeout(function() {
                a()
            }, 500);
            else
                for (var h = 0; h < e; h++)(function(b, c) {
                    chrome.cookies.remove({
                        url: b,
                        name: c
                    }, function(b) {
                        console.log(m, e, g, d);
                        ++m >= e && g >= d && setTimeout(function() {
                            a()
                        }, 500)
                    })
                })(b, c[h].name)
        })
    }
    for (var e = "http://www.12306.cn/mormhweb/kyfw/ https://www.12306.cn/mormhweb/kyfw/ http://dynamic.12306.cn/mormhweb/kyfw/ https://dynamic.12306.cn/mormhweb/kyfw/ http://www.12306.cn/otsweb/main.jsp/ https://www.12306.cn/otsweb/main.jsp/ http://dynamic.12306.cn/otsweb/main.jsp/ https://dynamic.12306.cn/otsweb/main.jsp/ https://kyfw.12306.cn/otn/passcodeNew/".split(" "),
            d = e.length, g = 0, b = 0; b < e.length; b++) c(e[b])
};