var Utils = Utils || {};
(function(b) {
    b.domModify = !0;
    b.updateInfo = {
        version: "2.0.0.1000",
        status: !1,
        codebase: ""
    };
    b.allSeats = "\u5546\u52a1\u5ea7 \u7279\u7b49\u5ea7 \u4e00\u7b49\u5ea7 \u4e8c\u7b49\u5ea7 \u9ad8\u7ea7\u8f6f\u5367 \u8f6f\u5367 \u786c\u5367 \u8f6f\u5ea7 \u786c\u5ea7 \u65e0\u5ea7 \u5176\u4ed6".split(" ");
    b.sendMessage = function(a, d) {
        "function" === typeof chrome.extension.sendMessage ? b.sendMessage = function(a, b) {
            chrome.extension.sendMessage(a, b)
        } : "function" === typeof chrome.extension.sendRequest && (b.sendMessage = function(a,
            b) {
            chrome.extension.sendRequest(a, b)
        });
        b.sendMessage(a, d)
    };
    b.messageAddListener = function() {
        function a(a, c, e) {
            c = a.type;
            switch (c) {
                case "error501":
                    window === window.parent && TicketException.alert_fix("\u6e29\u99a8\u63d0\u793a\uff1a12306\u8bc1\u4e66\u5b89\u88c5\u4e0d\u6b63\u5e38", "12306\u7f51\u7ad9\u901a\u8fc7\u5b89\u5168\u65b9\u5f0f\u8bbf\u95ee\u624d\u80fd\u6b63\u5e38\u4e70\u7968\uff0c\u56e0\u6b64\u9700\u8981\u5b89\u88c5\u94c1\u9053\u90e8\u63d0\u4f9b\u7684\u5b98\u65b9\u8bc1\u4e66\u540e\u624d\u80fd\u6b63\u5e38\u8bbf\u95ee\u3002\u73b0\u5728\u60a8\u5c1a\u672a\u6b63\u786e\u5b89\u88c5\u8bc1\u4e66\uff0c\u8bf7\u70b9\u51fb\u201c\u7acb\u5373\u4fee\u590d\u201d\u5f00\u59cb\u81ea\u52a8\u5b89\u88c5\u8bc1\u4e66\u3002",
                        c);
                    break;
                case "toQuery":
                    setTimeout(function() {
                        var a = $("#menu_left").find("li:eq(0) a");
                        0 < a.length && a.click()
                    }, 1E3 + 500 * Math.random());
                    break;
                case "switchToPathPlan":
                    e = $("cite:eq(6)").parent();
                    0 < e.length && e[0].click();
                    break;
                case "myOrder":
                    TicketQuery.inited && (window.location.href = Utils.getHostCtx() + a.url);
                    break;
                case "removeNotify":
                    TicketQuery.inited && TicketMode.removeNotify(a.stamp);
                    break;
                case "documentCLick":
                    TicketQuery.inited && TicketMode.closeBookNotify();
                    break;
                case "studentRefresh":
                    TicketQuery.inited &&
                        TicketQuery.studentRefresh(a.isStart);
                    break;
                case "refresh":
                    TicketQuery.inited && TicketQuery.refresh(a.isStart);
                    break;
                case "updateUserInfo":
                    TicketQuery.inited && TicketQuery.updateUserInfo(a.info, e);
                    break;
                case "updateServerConfig":
                    console.log(a.config);
                    b.domModify = "true" === (a.config.remarkResult || "false").toString();
                    break;
                case "getFrameOffset":
                    TicketQuery.inited && (a = TicketQuery.getFrameOffset(), console.log("----------------", a), a.success && e(a));
                    break;
                case "order":
                    TicketQuery.inited && TicketQuery.bookTickets(a.trainInfo);
                    break;
                case "refreshPassengers":
                    TicketQuery.inited && TicketQuery.refreshPassengers();
                    break;
                case "addPassenger":
                    TicketQuery.inited && location.replace(Utils.getHostCtx() + "/passengerAction.do?method=initAddPassenger&");
                    break;
                case "onQueryOrderCompleted":
                    $(TicketTuipiao).trigger("queryOrderCompleted");
                    break;
                case "onRefresh12306Orders":
                    $(TicketTuipiao).trigger("refresh12306Orders")
            }
            return !0
        }
        chrome.extension.onMessage && chrome.extension.onMessage.addListener ? chrome.extension.onMessage.addListener(a) : "undefined" !==
            chrome.extension.onRequest && chrome.extension.onRequest.addListener && chrome.extension.onRequest.addListener(a)
    };
    b.getHostCtx = function() {
        var a = "https://dynamic.12306.cn/otsweb";
        window.location && (window.location.protocol && window.location.host) && (a = window.location.protocol + "//" + window.location.host + "/otsweb");
        return a
    };
    b.notify = function(a) {
        b.sendMessage({
            type: "notify",
            info: a
        }, function() {})
    };
    b.route = function(a, b) {
        -1 !== window.location.href.indexOf(a) && b()
    };
    b.xssFilter = function(a) {
        "string" === typeof a && (a =
            a.replace(/&/g, "&amp;"), a = a.replace(/"/g, "&quot;"), a = a.replace(/'/g, "&#039;"), a = a.replace(/</g, "&lt;"), a = a.replace(/>/g, "&gt;"));
        return a
    };
    b.getOffsetTime = function(a) {
        return (a = new Date(a.getResponseHeader("Date"))) ? +new Date - +a : 2
    };
    b.setItem = function(a, b, c) {
        var e = {};
        e[a] = b;
        chrome.storage.local.set(e, c)
    };
    b.getItem = function(a, b) {
        chrome.storage.local.get([a], function(a) {
            b(a)
        })
    };
    b.getUserInfo = function(a) {
        var d = {};
        b.getItem("cur_user_id", function(c) {
            var e = "default_user";
            c.hasOwnProperty("cur_user_id") &&
                (e = c.cur_user_id);
            b.getItem(e, function(b) {
                b.hasOwnProperty(e) && (d = b[e]);
                a(d)
            })
        })
    };
    b.setUserInfo = function(a, d) {
        b.getItem("cur_user_id", function(c) {
            c.hasOwnProperty("cur_user_id") ? b.setItem(c.cur_user_id, a, d) : b.setItem("default_user", a, d)
        })
    };
    b.serverTime = null;
    b.getServerTime = function(a) {
        Utils.serverTime ? a(Utils.serverTime) : $.ajax({
            url: "http://kyfw.12306.cn/otn/resources/images/bg_navlist.png?_" + Math.random(),
            cache: !1,
            data: null,
            timeout: 1E4,
            type: "POST",
            success: function(d, c, e) {
                b.serverTime = +new Date(e.getResponseHeader("Date") ||
                    +new Date);
                a(Utils.serverTime)
            },
            error: function(d, c, e) {
                b.serverTime = +new Date(d.getResponseHeader("Date") || +new Date);
                a(Utils.serverTime)
            }
        })
    };
    b.getScrollBarWidth = function() {
        for (var a = window; a.parent && a !== a.parent;) a = a.parent;
        var b = a.document.body.style.overflow;
        a.document.body.style.overflow = "hidden";
        var c = a.document.body.clientWidth;
        a.document.body.style.overflow = "scroll";
        (c -= a.document.body.clientWidth) || (c = a.document.body.offsetWidth - a.document.body.clientWidth);
        a.document.body.style.overflow = b;
        return 10 <= c && 20 >= c ? c : 17
    };
    b.getTopWindow = function() {
        try {
            return parent === self ? self : parent.window.Passenger.getTopWindow()
        } catch (a) {
            return self
        }
    };
    b.ajax = function(a) {
        b.sendMessage({
            type: "ajax",
            settings: a
        }, function(b) {
            var c = b.data;
            b = b.status;
            if ("json" == a.dataType) try {
                c = JSON.parse(c)
            } catch (e) {}
            0 === b ? "function" == typeof a.success && a.success(c) : "function" == typeof a.error && a.error()
        })
    }
})(Utils);
Object.preventExtensions(Utils);
var TicketUpdate = TicketUpdate || {};
(function(b) {
    function a(a, b, e) {
        $(".help_share_bg").remove();
        var h = $('<div class="help_share_bg" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.2);background-image: -webkit-gradient(linear, left top, right bottom, color-stop(.25, rgba(255, 255, 255, .15)), color-stop(.25, transparent), color-stop(.5, transparent), color-stop(.5, rgba(255, 255, 255, .15)), color-stop(.75, rgba(255, 255, 255, .15)), color-stop(.75, transparent), to(transparent));-webkit-background-size: 40px 40px;z-index: 999;"><div class="help_share_dialog" style="color:#333333;font-size:12px;width:408px;height:160px;background:#eff2f5;border:#dddddd;position:fixed;top:150px;left:50%;margin-left:-200px;padding:4px;"><div class="help_share_dialog_title_bar" style="background:rgba(49,119,191,1);color:white;height:29px;line-height:29px;text-indent:10px;font-weight:bold;border:1px solid #aed0ea">\u5347\u7ea7\u63d0\u793a</div><div class="help-share_dialog_content"><div style="padding:5px 30px;line-height:16px;border-bottom:1px solid #dddddd;height:65px;">\u201c<span style="font-weight:bold;color:#27a12d">\u62a2\u7968\u738b</span>\u201d\u5df2\u7ecf\u6709\u65b0\u7248\u672c\uff0c\u7248\u672c\u53f7\uff1a<span class="crx_update_version">' + (a ||
            "") + '\uff0c\u662f\u5426\u5347\u7ea7\uff1f</span><br /><span class="crx_update_log"></span></div><div style="color:#fff;position:relative;padding-top:5px;"><button class="help_share_submit" style="position:absolute;left:80px;color:#fff;;background:#3f85cd;width:120px;height:30px;cursor:pointer;">\u7acb\u5373\u5347\u7ea7\uff01</button><button class="help_share_close" style=";position:absolute;left:225px;color:#fff;cursor:pointer;background:#3f85cd;width:80px;height:30px;">\u4e0b\u6b21\u518d\u8bf4</button><p class="update_tips" style="display: none;;position:absolute;top:20px;padding:0;text-align:center;width:100%;margin:0;color:#f00;">\u6b63\u5728\u5347\u7ea7\uff0c\u8bf7\u5728\u7a0d\u540e\u5f39\u51fa\u7684\u5bf9\u8bdd\u6846\u4e2d\u70b9\u51fb\u201c\u6dfb\u52a0\u201d\u5373\u53ef\u5b8c\u6210\u5347\u7ea7\u3002</p></div><div></div></div></div></div>').appendTo("body");
        h.find(".help_share_close").click(function(a) {
            h.remove();
            e && e()
        }).end().find(".help_share_submit").click(function(a) {
            window.open(b, "_blank");
            h.find("button").hide();
            h.find(".update_tips").show()
        })
    }
    b.init = function() {
        console.log(window.location.href);
        if (window.location.href.match(/init|login$/i)) {
            var b = Utils.getHostCtx() + "/order/querySingleAction.do?method=init";
            if (window.parent && window.parent.$) {
                var c = window.parent.$("#username_ a").attr("href");
                if (c && -1 !== c.indexOf("sysuser/user-info")) {
                    window.location.href =
                        b;
                    return
                }
            }
            Utils.sendMessage({
                type: "checkUpdate"
            }, function(b) {
                Utils.updateInfo = b;
                console.log(b);
                b && b.status && a(b.version, b.codebase, null)
            })
        }
    };
    b.initOtn = function() {
        var b = !1; - 1 !== window.location.href.indexOf("/otn/login/init") ? b = !0 : -1 !== window.location.href.indexOf("/otn/leftTicket/init") && $("#login_user").length && ("\u767b\u5f55" === $("#login_user").text() && "string" === typeof $("#login_user").attr("href") && -1 !== $("#login_user").attr("href").indexOf("/otn/login/init")) && (b = !0);
        b && Utils.sendMessage({
                type: "checkUpdate"
            },
            function(b) {
                Utils.updateInfo = b;
                console.log(b);
                b && b.status && a(b.version, b.codebase, null)
            })
    }
})(TicketUpdate);
Object.preventExtensions(TicketUpdate);
var TicketShare = TicketShare || {};
(function(b) {
    function a(a, b) {
        (new Image).src = "http://dd.browser.360.cn/static/a/" + a + "?_" + Math.random();
        0 !== $(b).length && Utils.sendMessage({
            type: "getServerConfig"
        }, function(a) {
            Utils.sendMessage({
                type: "getInitData"
            }, function(b) {
                var c = b.stype;
                if (void 0 !== c && 0 !== +c) try {
                    $(".help_share_bg").remove();
                    var d = $('<div class="help_share_bg" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.2);background-image: -webkit-gradient(linear, left top, right bottom, color-stop(.25, rgba(255, 255, 255, .15)), color-stop(.25, transparent), color-stop(.5, transparent), color-stop(.5, rgba(255, 255, 255, .15)), color-stop(.75, rgba(255, 255, 255, .15)), color-stop(.75, transparent), to(transparent));-webkit-background-size: 40px 40px;"><div class="help_share_dialog" style="color:#333333;font-size:12px;width:408px;background:#eff2f5;border:#dddddd;position:fixed;top:150px;left:50%;margin-left:-200px;padding:4px;"><div class="help_share_dialog_title_bar" style="background:rgba(49,119,191,1);color:white;height:29px;line-height:29px;text-indent:10px;font-weight:bold;border:1px solid #aed0ea">\u63d0\u793a<a class="help_share_title_close"></a></div><div class="help-share_dialog_content"><div style="padding:18px 45px;line-height:16px;border-bottom:1px solid #dddddd;">' + (a.payfinishShare.content ||
                            '\u606d\u559c\uff0c\u8d2d\u7968\u6210\u529f\uff01<br/>\u8bf7\u70b9\u51fb\u201c<span style="font-weight:bold;color:#27a12d">\u4e70\u5230\u7968\u4e86\uff0c\u5206\u4eab\u5230\u5fae\u535a</span>\u201d\u6309\u94ae<br />\u5c06\u4e70\u5230\u7968\u7684\u6d88\u606f\u5206\u4eab\u7ed9\u60a8\u7684\u597d\u53cb\uff0c\u5e2e\u52a9\u66f4\u591a\u4eba\u4e70\u5230\u706b\u8f66\u7968<p style="margin:10px 0 0;"><a style="color:#27a12d;text-decoration:underline;" href="http://distribute.browser.360.cn?token=bf099cb2f7851934918d596e5bbc4cb6&pid=62&time=1447901777&jumpUrl=aHR0cDovL2UuY2ljLmNuL3dlYi9wb3J0YWwuZG8/dXJsPXNNNXZ0V1dhbnU4RnJabkFheWszN2c9PSZhbXA7cmlza0NvZGU9MTk1MzAwMDA1Mg==" target="_blank">\u5168\u7f51\u72ec\u5bb6\u51fa\u884c\u4fdd\u969c\uff1a3\u5143100\u4e07\u610f\u5916\u9669\u8ba9\u60a8\u5b89\u5fc3\u51fa\u53d1</a></p>') +
                        '</div><div style="color:#fff;position:relative;padding-top:5px; height:37px;"><button class="help_share_submit" style="position:absolute;left:44px;color:#fff;;background:#3f85cd;padding:0 8px;height:30px;cursor:pointer;">' + (a.payfinishShare.shareButtonText || "\u4e70\u5230\u7968\u4e86\uff0c\u5206\u4eab\u5230\u5fae\u535a") + '</button><button class="help_more_url" style="position:absolute;left:225px;color:#fff;cursor:pointer;background:#3f85cd;padding:0 8px;height:30px;" href="' + (a.payfinishShare.moreButtonUrl ||
                            "http://distribute.browser.360.cn?token=ff244741a2708cfd3f9f14409989f45d&pid=62&time=1447904003&jumpUrl=aHR0cDovLzEyMzA2LjM2MC5jbi8/ZnJvbT1xaWFuZ3BpYW9jaGVuZ2dvbmc=") + '">' + (a.payfinishShare.moreButtonText || "\u67e5\u770b\u66f4\u591a\u798f\u5229") + "</button></div><div></div></div></div></div>").appendTo("body");
                    d.find(".help_share_close, .help_share_title_close").click(function(a) {
                        d.remove()
                    }).end().find(".help_more_url").click(function(a) {
                        /^https?:/.test($(this).attr("href")) && window.open($(this).attr("href"),
                            "_blank");
                        d.remove()
                    }).end().find(".help_share_submit").click(function(a) {
                        a = "http://chrome.360.cn/jump/shareticket.html";
                        2 === +c && (a = "http://se.360.cn/jump/shareticket.html");
                        window.open(a, "_blank");
                        d.remove()
                    })
                } catch (f) {}
            })
        })
    }
    b.init = function() {
        a("26.5432.gif", ".succed-big")
    };
    b.initOtn = function() {
        a("26.5642.gif", ".i-success")
    }
})(TicketShare);
Object.preventExtensions(TicketShare);
var TicketTuipiao = TicketTuipiao || {};
(function(b) {
    b.opened = !1;
    b.init = function() {
        $(TicketTuipiao).on("refresh12306Orders", function() {
            $("#querymyorderbutton")[0].click()
        });
        $(TicketTuipiao).on("queryOrderCompleted", function() {
            $("tr .btn92s").each(function() {
                if (!(0 < $(this).parent().find(".btn-px-tuipiao").length || -1 < $(this).parent().prev().text().indexOf("\u6539\u7b7e\u7968"))) {
                    var a = $(this).attr("onclick");
                    (a = a.match(/^returnTrainTicket\((.+?)\)$/)) && a[1] && (a = a[1].replace(/'/g, '"'), a = JSON.parse("[" + a + "]"), a = {
                        query_type: $("select[name=queryType]").val(),
                        start: $("#queryStartDate").val(),
                        end: $("#queryEndDate").val(),
                        sequence_no: a[0],
                        seat_no: a[3]
                    }, a = btoa(JSON.stringify(a)), a = $('<a href="http://pc.huochepiao.360.cn/tuipiao/?' + a + '" target="_blank" class="btn92s btn-px-tuipiao">360\u7701\u94b1\u9000\u7968</a>'), a.on("click", function() {
                        chrome.storage.local.set({
                            "tuipiao-opened": !0
                        })
                    }), $(this).after(a))
                }
            })
        })
    }
})(TicketTuipiao);
var OtnCaptcha = OtnCaptcha || {};
(function(b) {
    function a() {
        TicketCaptcha.stopCaptcha();
        c && $(".show-captcha-tips .captcha-tips").fadeOut(function() {
            b.removeTips()
        })
    }

    function d(a, c, d) {
        a.parent().addClass("show-captcha-tips");
        var f = $(".show-captcha-tips .captcha-tips");
        0 == f.length && (a.after('<div class="captcha-tips tips-' + c + '"></div>'), f = $(".show-captcha-tips .captcha-tips"));
        f.html("<em></em>" + d);
        clearTimeout(e);
        e = setTimeout(function() {
            f.fadeOut(function() {
                b.removeTips()
            })
        }, 5E3)
    }
    var c = !0,
        e;
    b.removeTips = function() {
        var a = $(".show-captcha-tips .captcha-tips");
        a.length && (a.parent().removeClass("show-captcha-tips"), a.remove())
    };
    b.crack = function(b, e, g) {
        if ($("#img_rand_code").is(":visible")) {
            var f = $("#randCode");
            f.unbind("focus click", a).bind("focus click", a);
            d(f, b, "360\u62a2\u7968\u738b\u6b63\u5728\u4e3a\u60a8\u81ea\u52a8\u8bc6\u522b\u9a8c\u8bc1\u7801...");
            TicketCaptcha.doGetCaptcha("#img_rand_code", e || "sjrand", function(a, e) {
                f.val(a);
                if (!0 === e) {
                    var k;
                    switch (b) {
                        case "login":
                            k = "360\u62a2\u7968\u738b\u5df2\u4e3a\u60a8\u79d2\u586b\u9a8c\u8bc1\u7801\uff0c\u5feb\u53bb\u62a2\u7968\u5427\uff01";
                            break;
                        case "submit":
                            k = "360\u62a2\u7968\u738b\u5df2\u4e3a\u60a8\u79d2\u586b\u9a8c\u8bc1\u7801\uff0c\u5feb\u53bb\u63d0\u4ea4\u8ba2\u5355\u5427\uff01"
                    }
                    d(f, b, k);
                    "function" === typeof g && setTimeout(function() {
                        g()
                    }, 100)
                } else !1 === e && (c = !1, f.focus(), c = !0, d(f, b, "\u8bc6\u522b\u5931\u8d25\uff0c\u8bf7\u60a8\u624b\u52a8\u586b\u5199\uff01"))
            }, 2, "/otn/passcodeNew/checkRandCodeAnsyn", 3E3)
        }
    };
    b.crack2 = function() {};
    b.init = function() {
        Utils.route("/login/init", function() {
            b.crack("login")
        });
        Utils.route("/confirmPassenger/initDc",
            function() {});
        Utils.route("/leftTicket/init", function() {
            $("#img_rand_code").on("load", function() {
                b.crack("submit-login")
            });
            $(document).delegate("a#relogin_close", "click", function() {
                $("#img_rand_code").on("load", function() {
                    b.crack("submit-login")
                })
            });
            $("#img_rand_code2").on("load", function() {
                b.crack2()
            });
            $(document).delegate("a#back_edit", "click", function() {
                $("#img_rand_code2").on("load", function() {
                    b.crack2()
                })
            })
        });
        Utils.route("/payOrder/init", function() {
            "true" === localStorage.__show_captcha_tips &&
                (d($("#payButton"), "autosubmit-pay", "360\u62a2\u7968\u738b\u5df2\u4e3a\u60a8\u79d2\u586b\u9a8c\u8bc1\u7801\uff0c\u5feb\u53bb\u652f\u4ed8\u5427\uff01"), localStorage.removeItem("__show_captcha_tips"))
        })
    }
})(OtnCaptcha);
Object.preventExtensions(OtnCaptcha);
var TicketCaptcha = TicketCaptcha || {};
(function(b) {
    function a(a, b) {
        a.complete ? b() : a.onload = a.onerror = function() {
            a.onload = a.onerror = null;
            b()
        }
    }

    function d(a, b) {
        var c = new XMLHttpRequest;
        c.open("GET", a);
        c.responseType = "blob";
        c.onreadystatechange = function() {
            if (4 == c.readyState && 200 == c.status) {
                var a = new FileReader;
                a.onload = function() {
                    b(a.result)
                };
                a.readAsDataURL(c.response)
            }
        };
        c.send()
    }

    function c(a, b) {
        d(a.src, function(c) {
            a.src = c;
            c = c.replace("data:image/jpeg;base64,", "").replace("data:image/png;base64,", "").replace("data:image/gif;base64,", "");
            b(c)
        })
    }
    b.checkOtnCaptcha = function(a, b, c, d, e) {
        4 > a.length || "0000" == a ? c({
            code: a,
            success: !1
        }) : "string" !== typeof d || 20 > d.length || $.ajax({
            url: d,
            cache: !1,
            data: {
                randCode: a,
                rand: b
            },
            type: "POST",
            timeout: e || 1E4,
            success: function(b, d, e) {
                c({
                    code: a,
                    success: "Y" === b.data || b.data && "1" === b.data.result
                })
            },
            error: function(a, b, d) {
                c({
                    code: "",
                    success: !1
                })
            }
        })
    };
    b.getCaptcha = function(b, c, d) {
        "string" === typeof b ? chrome.extension.sendMessage({
            type: "getCaptcha",
            data: b,
            options: c
        }, d) : a(b, function() {
            var a;
            a = document.createElement("canvas");
            var e = a.getContext("2d");
            try {
                a.width = b.naturalWidth, a.height = b.naturalHeight, e.drawImage(b, 0, 0)
            } catch (l) {}
            a = a.toDataURL("image/png").replace("data:image/png;base64,", "");
            chrome.extension.sendMessage({
                type: "getCaptcha",
                data: a,
                options: c
            }, d)
        })
    };
    var e = !1;
    b.doGetCaptcha = function(a, d, g, f, m, l, p) {
        void 0 === f && (f = 3);
        p || (e = !0);
        var n = $(a);
        c(n[0], function(c) {
            b.getCaptcha(c, function(c) {
                e ? (g(c), b.checkOtnCaptcha(c, d, function(c) {
                    console.log("captcha" + (c.success ? "\u6210\u529f" : "\u5931\u8d25") + ":", c.code);
                    c.success ||
                        1 >= f ? g(c.code, c.success) : setTimeout(function() {
                            n.trigger("click");
                            b.doGetCaptcha(a, d, g, --f, m, l, !0)
                        }, 200)
                }, m, l)) : console.log("onfocus stop retry")
            })
        })
    };
    b.stopCaptcha = function() {
        e = !1
    }
})(TicketCaptcha);
Object.preventExtensions(TicketCaptcha);
var OtnLogin = OtnLogin || {};
(function(b) {
    function a() {
        var a = $(d.userName);
        Utils.setItem("otn_cur_user_id", 0 < a.length ? a[0].value : "", function() {});
        Utils.setItem("otn_cur_login_stamp", +new Date, function() {})
    }
    var d = {
        userName: "#UserName",
        subLink: "#loginSub",
        randCode: "#randCode",
        submitOrder: "#submitOrder_id",
        autoSubmitOrder: "#qr_submit",
        payButton: "#payButton"
    };
    b.login = function() {
        $(d.subLink)[0].click()
    };
    b.init = function() {
        $(d.randCode).keyup(function(c) {
            if (13 === c.charCode || 4 === $(d.randCode).val().length) a(), setTimeout(function() {
                    b.login()
                },
                50 + 200 * Math.random())
        });
        $(d.subLink).live("click", function() {
            OtnCaptcha.removeTips();
            a();
            b.login()
        });
        $(d.submitOrder).live("click", function() {
            OtnCaptcha.removeTips();
            $(d.submitOrder)[0].click()
        });
        $(d.autoSubmitOrder).live("click", function() {
            OtnCaptcha.removeTips();
            $(d.autoSubmitOrder)[0].click()
        });
        $(d.payButton).live("click", function() {
            OtnCaptcha.removeTips();
            $(d.payButton)[0].click()
        })
    }
})(OtnLogin);
Object.preventExtensions(OtnLogin);
var OtnSkipHome = OtnSkipHome || {};
(function(b) {
    b.init = function() {
        Utils.getItem("otn_cur_login_stamp", function(a) {
            if (a.hasOwnProperty("otn_cur_login_stamp")) {
                var b = +new Date,
                    b = b - a.otn_cur_login_stamp;
                0 > b || 2E3 < b || setTimeout(function() {
                    var a = $("#selectYuding").find("a");
                    location.href.match(/index\/init$/) && 0 < a.length && a[0].click()
                }, 50 + 200 * Math.random())
            }
        })
    }
})(OtnSkipHome);
Object.preventExtensions(OtnSkipHome);
var TicketQuery = TicketQuery || {};
(function() {
    TicketQuery.inited = !1;
    Utils.messageAddListener();
    TicketUpdate.initOtn();
    Utils.route("login/init", OtnLogin.init);
    Utils.route("payOrder/init", OtnLogin.init);
    Utils.route("confirmPassenger/initDc", OtnLogin.init);
    Utils.route("leftTicket/init", OtnLogin.init);
    Utils.route("index/init", OtnSkipHome.init);
    Utils.route("/otn/payfinish/init", TicketShare.initOtn);
    Utils.sendMessage({
        type: "getServerConfig"
    }, function(b) {
        "true" === (b.newCheck || "false").toString() && OtnCaptcha.init();
        "true" === (b.injectTuipiao ||
            "false").toString() && Utils.route("/otn/queryOrder/init", TicketTuipiao.init)
    })
})();