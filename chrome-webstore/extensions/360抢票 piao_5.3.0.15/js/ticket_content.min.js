$(function() {
    window === parent && -1 !== location.href.indexOf("https://dynamic.12306.cn/otsweb/main.jsp") && (location.href = "http://www.12306.cn/mormhweb/kyfw/");
    Utils.sendMessage({
        type: "hidePanel"
    }, function() {});
    Utils.sendMessage({
        type: "getServerConfig"
    }, function(a) {
        console.log(a);
        Utils.domModify = "true" === (a.remarkResult || "false").toString()
    });
    Utils.route("loginAction.do?method=init", TicketLogin.init);
    Utils.route("loginAction.do?method=login", TicketLogin.init);
    Utils.route("querySingleAction.do", TicketQuery.init);
    Utils.route("confirmPassengerResignAction.do?method=cancelOrderToQuery", TicketQuery.init);
    Utils.route("payConfirmOnlineSingleAction.do?method=cancelOrder", TicketQuery.init);
    Utils.route("orderAction.do?method=cancelMyOrderNotComplete", TicketQuery.init);
    Utils.route("passengerAction.do?method=initUsualPassenger12306", TicketPassenger.init);
    Utils.route("myOrderAction.do?method=init&showMessage=Y&manual=true", TicketQuery.initMyOrder);
    Utils.route("confirmPassengerAction.do?method=init", TicketCommit.init);
    Utils.route("loginAction.do?method=init", TicketUpdate.init);
    Utils.messageAddListener();
    Utils.route("payConfirmOnlineResignAction.do?method", TicketShare.init);
    Utils.route("payConfirmOnlineSingleAction.do?method", TicketShare.init);
    try {
        window.parent.$("#main").attr("height", parseInt(window.parent.$("#main").attr("height"), 10) + 200)
    } catch (b) {}
    console.log = function() {}
});
var TicketCommit = TicketCommit || {};
(function(b) {
    function a() {
        var b = +new Date,
            c = 0;
        setTimeout(function() {
            c++;
            var d = $("#passenger_single_tb_id").find("td[colspan] input");
            d.length ? 1 === d.length && d[0].click() : 1E4 > +new Date - b && setTimeout(a, 100 * c)
        }, 100);
        setTimeout(function() {
            var a = f.passengers || [],
                b = $("#showPassengerFilter").find("._checkbox_class"),
                c = $(".passenger_class"),
                c = 0 < c.length ? $(c[0]).find('input[name="passenger_1_name"]') : [],
                c = 0 < c.length ? c[0].value : "";
            if ("" === c)
                for (c = 0; c < a.length; c++) {
                    var e = a[c];
                    if (e.selected)
                        for (var h = 0; h < b.length; h++) {
                            var p =
                                b[h].id;
                            (p = p.match(/[\d|\w]{18}$/)) && (0 < p.length && -1 !== hex_md5(p[0]).indexOf(e.id)) && $(b[h]).trigger("click")
                        }
                }
            d();
            $("#rand").focus()
        }, 500 + 500 * Math.random())
    }

    function d() {
        var a = Utils.allSeats,
            c = f.autoBook && "true" === f.autoBook.toString(),
            b = f.autoSeats || a,
            d = f.realSelectedSeat || f.seats || a,
            d = d.join(",").replace(/\u65e0\u5ea7/g, "\u786c\u5ea7").split(","),
            b = b.join(",").replace(/\u65e0\u5ea7/g, "\u786c\u5ea7").split(",");
        $(".passenger_class").each(function(a, e) {
            for (var f = $(e).find("td:eq(2)").find("option"),
                    h = 0; h < d.length; h++) {
                for (var v = !1, w = 0; w < f.length; w++) {
                    var x = f[w].innerText;
                    if (x === d[h] && (!c || -1 !== b.indexOf(x))) {
                        v = !0;
                        $(f[w]).attr("selected", "selected");
                        break
                    }
                }
                if (v) break
            }
        })
    }

    function c() {
        setTimeout(function() {
            var a = $('.long_button_u:contains("\u63d0\u4ea4\u8ba2\u5355")');
            0 < a.length && a[0].click()
        }, 200 + 200 * Math.random())
    }
    var e = +new Date,
        f = {};
    b.init = function() {
        Utils.getUserInfo(function(c) {
            f = c;
            a();
            f.autoBook || Utils.sendMessage({
                type: "notify",
                notifyInfo: {
                    method: "cancel",
                    audioPlay: !1,
                    msg: ""
                }
            }, function() {})
        });
        var b = $("#rand");
        b.keyup(function(a) {
            if (13 === a.charCode || 4 === b.val().length) Utils.sendMessage({
                type: "notify",
                notifyInfo: {
                    method: "cancel",
                    audioPlay: !1,
                    msg: ""
                }
            }, function() {}), 1E3 < +new Date - e && c()
        })
    }
})(TicketCommit);
Object.preventExtensions(TicketCommit);
var TicketException = TicketException || {};
(function(b) {
    b.alert_fix = function(a, b, c) {
        try {
            var e = document.querySelector(".help_share_bg");
            null !== e && e.parentNode.removeChild(document.querySelector(".help_share_bg"));
            var f = document.createElement("div");
            f.setAttribute("class", "help_share_bg");
            f.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.2);background-image: -webkit-gradient(linear, left top, right bottom, color-stop(.25, rgba(255, 255, 255, .15)), color-stop(.25, transparent), color-stop(.5, transparent), color-stop(.5, rgba(255, 255, 255, .15)), color-stop(.75, rgba(255, 255, 255, .15)), color-stop(.75, transparent), to(transparent));-webkit-background-size: 40px 40px;";
            f.innerText =
                '<div class="help_share_dialog" style="color:#333333;font-size:12px;width:408px;height:160px;background:#eff2f5;border:#dddddd;position:fixed;top:50%;left:50%;margin-left:-200px;margin-top:-150px;padding:4px;"><div class="help_share_dialog_title_bar" style="background:rgba(49,119,191,1);color:white;height:29px;line-height:29px;text-indent:10px;font-weight:bold;border:1px solid #aed0ea;">' + a + '<a class="help_share_close" style="cursor:pointer;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAABAElEQVQ4T62UURGEMAxEgwS01AJIAAlYAAlgAQkgATwhoccys502Tbkf+sNMk75sNrmr5KNTfcSRDHQch2/btlhg2zbf930WTy4AaZpG9n0XK/ktHkBMYqsa9i/+gHSShlnx67rkPM+gPChC713XZd5Dmb4HZF1XmaYpvE88mufZj+P4OkgLggeZ+4ANwyB1XWfAEsQE4VIrAwDgZVmSduJK5h5hBayjDS6C9HTwEEe3ae2ZuUcEAILpxJ4xFo8+eAQlzrmnMhPxRWWMmAOIW6Hxt2+PmGSP6E0M4WPAsE8sBqWEZFPDUkIZlWjDCdMQc/ylXzeh98L6WAnvP/s/+gFsycUT0UZplQAAAABJRU5ErkJggg==) no-repeat;display:block;width:18px;height:18px;float:right;margin:4px;"></a></div><div class="help-share_dialog_content"><div style="padding:10px 30px;line-height:16px;border-bottom:1px solid #dddddd;height:65px;"><span>' +
                b + '</span></div><div style="color:#fff;position:relative;padding-top:5px;"><button class="help_share_submit" style="position:absolute;left:100px;color:#fff;;background:#3f85cd;width:180px;height:30px;cursor:pointer;">\u7acb\u5373\u4fee\u590d</button></div><div></div></div></div>';
            document.body.appendChild(f);
            document.querySelector(".help_share_close").addEventListener("click", function() {
                document.querySelector(".help_share_bg").parentNode.removeChild(document.querySelector(".help_share_bg"));
                document.querySelector(".help_share_dialog").parentNode.removeChild(document.querySelector(".help_share_dialog"))
            });
            document.querySelector(".help_share_submit").addEventListener("click", function() {
                this.disabled = !0;
                chrome.extension.sendMessage({
                    type: c
                }, function(a) {
                    "deleteCookies" === c ? (location.href.match(/12306\.cn\/mormhweb\/logFiles\/error\.html/) && (location.href = "https://dynamic.12306.cn/otsweb/?_" + Math.random()), location.reload(!0)) : "error501" === c && (0 === a ? (location.reload(!0), alert("\u5df2\u7ecf\u6210\u529f\u4e3a\u60a8\u5b89\u88c5\u597d\u8bc1\u4e66\u3002\u5982\u679c\u95ee\u9898\u4ecd\u672a\u89e3\u51b3\uff0c\u8bf7\u60a8\u91cd\u542f\u6d4f\u89c8\u5668\u540e\u518d\u8bd5\u3002")) :
                        1 === a ? alert("\u62b1\u6b49\u81ea\u52a8\u8bc1\u4e66\u5b89\u88c5\u5931\u8d25\u4e86\uff0c\u8bf7\u5c1d\u8bd5\u624b\u5de5\u5b89\u88c5\u3002") : 2 === a && alert("\u62b1\u6b49\uff0c\u81ea\u52a8\u8bc1\u4e66\u5b89\u88c5\u6210\u529f\uff0c\u4f46\u4ecd\u672a\u80fd\u5e2e\u60a8\u89e3\u51b3\uff0c\u8bf7\u5230\u8bba\u575b\u5bfb\u6c42\u5e2e\u52a9\u3002"))
                })
            })
        } catch (h) {}
    };
    window.onload = function() {
        var a = location.href,
            b = document.getElementById("error") && document.getElementById("err_top");
        (a.match(/12306\.cn\/mormhweb\/logFiles\/error\.html/) ||
            b) && window.postMessage({
            type: "deleteCookies"
        }, "*")
    }
})(TicketException);
Object.preventExtensions(TicketException);
var TicketLogin = TicketLogin || {};
(function(b) {
    function a() {
        var a = $(d.userName);
        Utils.setItem("cur_user_id", 0 < a.length ? a[0].value : "", function() {})
    }
    var d = {
        userName: "#UserName",
        subLink: "#subLink",
        randCode: "#randCode",
        bookTicket: "#bookTicket"
    };
    b.init = function() {
        $(d.randCode).keyup(function(b) {
            if (13 === b.charCode || 4 === $(d.randCode).val().length) a(), setTimeout(function() {
                $(d.subLink)[0].click()
            }, 500 + 200 * Math.random())
        });
        $(d.subLink).live("click", function() {
            a();
            $(d.subLink)[0].click()
        });
        setTimeout(function() {
            var a = $(d.bookTicket).find("a");
            location.href.match(/method=login$/) && 0 < a.length && a[0].click()
        }, 200 + 200 * Math.random())
    }
})(TicketLogin);
Object.preventExtensions(TicketLogin);
var TicketPassenger = TicketPassenger || {};
(function(b) {
    function a(a, b, e, f, h, p, t) {
        function s(a) {
            a = a.responseText;
            var b = 1,
                b = a && -1 === a.indexOf("<title>\u767b\u5f55</title>") ? b : -1;
            return a && "-1" === a ? 0 : b
        }
        var q = function(a) {
            var b = s(a);
            window.sessionStorage.setItem("getAllPassengerDisabled", !0);
            h.apply(this, arguments); - 1 === b ? (window.parent && window.parent.window.alert("\u7cfb\u7edf\u5df2\u5f3a\u5236\u9000\u51fa\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002"), location.href = Utils.getHostCtx() + "/loginAction.do?method=init") : window.alert("\u64cd\u4f5c\u5931\u8d25\uff0c\u53ef\u80fd\u662f\u94c1\u9053\u4e0d\u7cfb\u7edf\u5347\u7ea7\u5bfc\u81f4\u3002")
        };
        $.ajax({
            url: a,
            data: b,
            timeout: 5E3,
            type: "POST",
            success: function(a, b, c) {
                1 > s(c) ? q(c) : f.apply(this, arguments)
            },
            error: q,
            dataType: e,
            refer: Utils.getHostCtx() + t
        })
    }
    b.getAllPassengers = function(b) {
        function c() {
            a("/otsweb/passengerAction.do?method=getPagePassengerAll", {
                pageSize: 10,
                pageIndex: f
            }, "json", function(a) {
                $.each(a.rows, function() {
                    e.push(this)
                });
                e.length >= a.recordCount ? b(e) : (f++, setTimeout(c, 1E3))
            }, function() {
                setTimeout(c, 3E3)
            }, "pasload", "/otsweb/passengerAction.do?method=initUsualPassenger12306")
        }
        var e = [],
            f = 0;
        c()
    };
    b.init = function() {
        function a() {
            $("#psgTable").find("tr.removeFlag").each(function(a, b) {
                var c = $(b).find("td"),
                    d = c.eq(1).text(),
                    q = c.eq(4).text();
                if (!(4 > c.length) && /^[\d]{17,18}/.test(q)) {
                    q = window.hex_md5(q);
                    c = {
                        name: d,
                        id: q,
                        selected: !1
                    };
                    for (d = 0; d < e.length; d++)
                        if (e[d].id === q) {
                            c = e[d];
                            break
                        }
                    f.push(c)
                }
            });
            TicketQuery.updateUserInfo({
                passengers: f
            }, function() {
                var b = $("#Pagination").find("a.next"); - 1 !== location.href.indexOf("manual") && 0 < b.length ? (b[0].click(), setTimeout(function() {
                        a()
                    }, 500 + 500 * Math.random())) :
                    -1 !== location.href.indexOf("manual") && 0 === b.length && (window.location = "/otsweb/order/querySingleAction.do?method=init&manual=yes")
            })
        }

        function b() {
            Utils.getUserInfo(function(b) {
                e = b.passengers || [];
                a()
            })
        }
        var e = [],
            f = [];
        $("body").ready(function() {
            var a = 0;
            if (0 < $("#psgTable").find("tr.removeFlag").length) b();
            else var d = setInterval(function() {
                if (20 <= ++a || 0 < $("#psgTable").find("tr.removeFlag").length) clearInterval(d), b()
            }, 200)
        })
    }
})(TicketPassenger);
Object.preventExtensions(TicketPassenger);
var TicketQuery = TicketQuery || {};
(function(b) {
    function a() {
        var a = [];
        Utils.allSeats.forEach(function(b) {
            var c = !0,
                c = g && g.seats && 0 < g.seats.length ? -1 < g.seats.indexOf(b) : !0;
            a.push(c)
        });
        return [!1, !1, !1, !1].concat(a)
    }

    function d(a) {
        E.push({
            type: $(".hdr tbody tr:last td").eq($(a).index() - 1).html(),
            count: $(a).text()
        });
        Utils.domModify && $(a).css("background-color", "#2CC03E")
    }

    function c(m, b) {
        var c = !1,
            e = [];
        g && g.limitTrain && (e = g.limitTrain.toUpperCase().match(/[A-Za-z][\d]{1,6}|[\d]{2,6}/g));
        if (0 < e.length && "" !== e[0]) {
            var k = $.trim($(m).find(".base_txtdiv").text());
            if (-1 === e.indexOf(k) && 0 < b) return Utils.domModify && $(m).hide(), !1
        }
        if ($(m).find("td input.yuding_x[type=button]").length) return !1;
        e = $(m).find("td");
        if (5 > e.length) return !1;
        for (k = $.map($(e[1]).text().replace(/^\D+|\D+$/, "").split(/\D+0?/), function(a) {
                return parseInt(a, 10) || 0
            }); 2 < k.length;) k.shift();
        var k = $(e[0]).find("span"),
            k = 0 < k.length ? k[0].innerHTML : "",
            k = k.toUpperCase(),
            l = [],
            f = g && g.minTickets ? g.minTickets : 1,
            h = a();
        e.each(function(a, m) {
            if (h[a]) {
                var b = $.trim($(m).text());
                "\u6709" === b ? (c = !0, l.push(a),
                    d(m)) : +b.match(/^\d+$/) >= f && (l.push(a), d(m), c = !0)
            }
        });
        c && r.push({
            rowIndex: b - 1,
            trainNumber: k,
            trainSeats: l
        });
        return c
    }

    function e(a, b) {
        for (var c = 0; c < a.length; c++) a[c] = a[c].toLowerCase();
        return 0 === a.length ? 0 : a.indexOf(b.toLowerCase())
    }

    function f(a, b) {
        if (0 === a.length) return 0;
        for (var c = Utils.allSeats.concat([""]), d = -1, e = 0; e < b.length; e++) {
            var l = a.indexOf(c[b[e] - 4]); - 1 !== l && (-1 === d || d > l) && (d = l)
        }
        return d
    }

    function h() {
        function a(m, c) {
            var d = null,
                e, L = [],
                Q = Utils.allSeats,
                l = Math.floor(r.length * Math.random());
            for (e = 0; e < r.length; e++) {
                var f = r[e]; - 1 !== f[m] && -1 !== f[c] && (!d || f[m] < d[m] || f[m] === d[m] && f[c] < d[c]) && (d = f)
            }
            d = d || r[l];
            for (e = 0; e < d.trainSeats.length; e++) L.push(Q[d.trainSeats[e] - 4]);
            b.updateUserInfo({
                autoSeats: L
            }, function() {
                $($(".btn130_2, .btn130")[d.rowIndex])[0].click()
            })
        }
        for (var c = g.propertyOrder || "\u8f66\u6b21\u4f18\u5148", d = g.limitTrain ? g.limitTrain.toUpperCase().match(/[A-Za-z][\d]{1,6}|[\d]{2,6}/g) : [], R = g.seats || [], k = 0; k < r.length; k++) {
            var l = r[k];
            l.trainPrior = e(d, l.trainNumber);
            l.seatsPrior = f(R,
                l.trainSeats);
            r[k] = l
        }
        "\u8f66\u6b21\u4f18\u5148" === c ? a("trainPrior", "seatsPrior") : a("seatsPrior", "trainPrior")
    }

    function p() {
        Utils.sendMessage({
            type: "notify",
            notifyInfo: {
                method: "create",
                audioPlay: !0,
                msg: "\u53ef\u4ee5\u8ba2\u7968\u4e86\uff01"
            }
        }, function() {});
        Utils.sendMessage({
            type: "refreshStopped",
            msgInfo: y
        }, function() {});
        g.autoBook && h()
    }

    function t(a) {
        var b = a.getFullYear(),
            c = a.getMonth() + 1;
        a = a.getDate();
        c = 9 >= c ? "0" + String(c) : String(c);
        a = 9 >= a ? "0" + String(a) : String(a);
        return String(b) + "-" + c + "-" + a
    }

    function s(a) {
        a =
            $.map(a.replace(/^\D+/, "").replace(/\D$/, "").split(/\D+0?/), function(a) {
                return parseInt(a, 10)
            });
        a[1] -= 1;
        var b = new Date;
        b.setFullYear(a[0]);
        b.setMonth(a[1], a[2]);
        b.setDate(a[2]);
        return b
    }

    function q() {
        if (g.autoLoop && g.autoLoop.isOpened)
            if (C) {
                var a = s(M),
                    b = g.autoLoop.decreaseDays || 0,
                    c = g.autoLoop.increaseDays || 0,
                    d = [],
                    e = [],
                    f;
                z = [t(a)];
                for (f = 1; f <= b; f++) d.push(t(new Date(a.getTime() - f * A)));
                for (f = 1; f <= c; f++) e.push(t(new Date(a.getTime() + f * A)));
                for (console.warn(d, e); 0 < d.length || 0 < e.length;) 0 < d.length && z.push(d.shift()),
                    0 < e.length && z.push(e.shift());
                D = 1;
                C = !1
            } else D >= z.length && (D = 0), document.getElementById("startdatepicker").value = z[D++]
    }

    function O(a) {}

    function P(a) {
        var b = $("#stu_submitQuery");
        b.removeClass();
        b.addClass(a);
        "research_u" === a && "research_u" === $("#submitQuery").attr("class") && (a = $("#submitQuery"), a.removeClass(), a.addClass("search_u"))
    }

    function K() {
        var a = ["06-01 00:00:00", "12-01 00:00:00", "01-01 00:00:00"],
            b = ["09-30 00:00:00", "12-31 00:00:00", "03-31 00:00:00"],
            c = (new Date).getFullYear(),
            d = n.getStartPicker().val(),
            e = $("#roundTrainDate").val(),
            f;
        "" !== d && "input_20hui" !== n.getStartPicker().attr("class") ? f = d + " 00:00:00" : "" !== e && (f = e + " 00:00:00");
        var d = c + "-" + a[0],
            e = c + "-" + b[0],
            g = c + "-" + a[1],
            h = c + "-" + b[1],
            p = c + "-" + a[2],
            s = c + "-" + b[2],
            a = parseInt(c, 10) + 1 + "-" + a[2],
            b = parseInt(c, 10) + 1 + "-" + b[2];
        return f >= d && f <= e || f >= g && f <= h || f >= p && f <= s || f >= a && f <= b
    }

    function v() {
        K() && P("stu_search_u");
        var a = $("#stu_submitQuery").hasClass("stu_search_u");
        $("#stu_submitQuery").attr("disabled", !a);
        g.studentticket = a;
        b.updateUserInfo({
                studentticket: a
            },
            function() {
                Utils.sendMessage({
                    type: "refreshStudentBtn",
                    status: a
                }, function() {})
            })
    }

    function w(a, b) {
        Utils.getServerTime(function(c) {
            var d = s($("#startdatepicker").val()).getTime();
            c = c || +new Date;
            var e = B ? S : T;
            c -= c % A;
            b(++a, d >= c && d < c + e * A)
        })
    }

    function x(a) {
        F = !0;
        $("#fromStation").val() && $("#toStation").val() || (u = !1, Utils.sendMessage({
            type: "refreshStopped"
        }, function() {}));
        var b = 0;
        for (q(); B && !K() && !(10 <= b++);) q();
        v();
        w(a || 0, function(a, b) {
            b || 20 <= a ? (O(++G), Utils.sendMessage({
                    type: "refreshCount",
                    value: G
                }, function() {}),
                B ? n.getStuSubmitBtn().click() : n.getSubmitBtn().click(), H = !0) : x(a)
        })
    }

    function U() {
        console.log("st m...");
        n.getSubmitBtn().add(n.getStuSubmitBtn()).click(function() {
            V();
            n.getResultGrid().data("__prev_innerText", "")
        });
        n.getSubmitBtn().propertyChange("className", function() {
            $(this).hasClass("search_u") && u && setTimeout(function() {
                x()
            }, 500 + 500 * (G % 3) * Math.random())
        });
        n.getResultGrid().propertyChange("innerText", function() {
            H && (r = [], y = [], $(this).find("tr").each(function(a, b) {
                E = [];
                if (c(b, a)) {
                    I = !0;
                    Utils.domModify &&
                        $(b).css("background-color", "#D1E1F1");
                    var d = /[\d]{2}:[\d]{2}/,
                        e = /&nbsp;[^<]+/,
                        f = $(this).children("td:eq(1)").html(),
                        g = $(this).children("td:eq(2)").html(),
                        h = $(this).children("td:eq(0)").children("span:eq(0)").html(),
                        p = f.match(d)[0],
                        d = g.match(d)[0],
                        f = f.match(e)[0].replace(/&nbsp;/g, ""),
                        e = g.match(e)[0].replace(/&nbsp;/g, ""),
                        g = $(this).children("td:eq(3)").html(),
                        h = {
                            number: h,
                            startTime: p,
                            stopTime: d,
                            startStation: f,
                            stopStation: e,
                            duration: g,
                            seats: E
                        };
                    console.log(h);
                    y.push(h)
                }
            }), F && (F = !1, I && (u && J(), p())))
        });
        n.getStartPicker()[0].onchange = function() {
            v()
        }
    }

    function W() {
        var a = "" !== $("#startdatepicker").val(),
            b = $("#fromStationText").val(),
            c = $("#toStationText").val(),
            b = b !== c && -1 === (b + c).indexOf("\u7b80\u7801/\u6c49\u5b57");
        return a && b
    }

    function N(a) {
        console.log("s rfh...");
        y = [];
        Utils.sendMessage({
            type: "notify",
            notifyInfo: {
                method: "cancel",
                audioPlay: !1,
                msg: ""
            }
        }, function() {});
        W() ? b.updateUserInfo({
            realSelectedSeat: null
        }, function() {
            B = a;
            u || (I = !1, C = u = !0, M = document.getElementById("startdatepicker").value, x())
        }) : (Utils.sendMessage({
            type: "refreshStopped",
            msgInfo: y
        }, function() {}), B ? n.getStuSubmitBtn().click() : n.getSubmitBtn().click())
    }

    function J() {
        console.log("sto ...");
        u && (u = !1);
        H = !1
    }

    function V() {
        b.updateUserInfo({
            fromStation: $("#fromStation").val(),
            fromStationText: $("#fromStationText").val(),
            toStation: $("#toStation").val(),
            toStationText: $("#toStationText").val(),
            startDate: $("#startdatepicker").val()
        }, function() {})
    }

    function X(a) {
        setTimeout(function() {
            var b = $("#fromStationText"),
                c = $("#fromStation"),
                d = $("#toStationText"),
                e = $("#toStation");
            0 < b.length &&
                d.length && (a && a.fromStationText && a.toStation) && (c.val(a.fromStation), b.val(a.fromStationText).attr({
                    "class": "input_20txt"
                }), e.val(a.toStation), d.val(a.toStationText).attr({
                    "class": "input_20txt"
                }));
            a && a.startDate && Utils.getServerTime(function(b) {
                s(a.startDate).getTime() > b - b % A && ($("#startdatepicker").val(a.startDate), v())
            })
        }, 500 + 500 * Math.random())
    }

    function Y(a) {
        Utils.getUserInfo(function(c) {
            g = c;
            g.studentticket = $("#stu_submitQuery").hasClass("stu_search_u");
            g.lowerberth = g.lowerberth || !1;
            g.propertyOrder =
                g.propertyOrder || "\u8f66\u6b21\u4f18\u5148";
            g.autoLoop = g.autoLoop || {
                isOpened: !1,
                decreaseDays: 1,
                increaseDays: 1
            };
            g.seats = g.seats || [];
            g.seats = 0 === g.seats.length ? Utils.allSeats : g.seats;
            X(g);
            U();
            b.updateUserInfo(g, a)
        })
    }
    var T = 20,
        S = 30,
        A = 864E5,
        M = null,
        C = !0,
        H = !1,
        D = 1,
        z = [],
        G = 0,
        B = !1,
        F = !1,
        r = [],
        u = !1,
        I = !1,
        E = [],
        y = [],
        g = null;
    b.getFrameOffset = function(a) {
        var b = {
                success: !1
            },
            c = $(window).scrollTop(),
            d = $(window).scrollLeft();
        $("iframe").each(function() {
            "https://dynamic.12306.cn/otsweb/" === $(this).attr("src") && (b = $(this).offset(),
                b.success = !0, b.top -= c, b.left -= d);
            return !1
        });
        return b
    };
    var n = {
        getResultGrid: function() {
            var a = $(".obj:first");
            return 0 < a.length ? a : a = $(".objbox:first").find("table:first")
        },
        getSubmitBtn: function() {
            var a = $("#submitQuery,.search_u:first");
            if (0 < a.length) return a;
            $("button").each(function() {
                var b = -1 < $(this).css("background").indexOf("/search_u.");
                b && (a = $(this));
                return b
            });
            return a
        },
        getStuSubmitBtn: function() {
            var a = $("#stu_submitQuery,.stu_search_u:first");
            if (0 < a.length) return a;
            $("button").each(function() {
                var b = -1 < $(this).css("background").indexOf("/stu_search_u.");
                b && (a = $(this));
                return b
            });
            return a
        },
        getStartPicker: function() {
            return $("#startdatepicker")
        }
    };
    b.inited = !1;
    b.bookTickets = function(a) {
        b.updateUserInfo({
            realSelectedSeat: [a.seatType]
        }, function() {
            $(".base_txtdiv").each(function() {
                if (this.innerText.trim() === a.number) {
                    var b = $(this).parent().parent().children("td:last").children("a");
                    0 < b.length ? b[0].click() : alert("\u672c\u6b21\u5237\u7968\u7ed3\u679c\u5df2\u8fc7\u671f\uff0c\u8bf7\u70b9\u51fb\u201c\u5f00\u59cb\u5237\u7968\u201d\u5237\u65b0\u7ed3\u679c\uff01")
                }
            })
        })
    };
    localStorage.lastCheckTime = localStorage.lastCheckTime || +new Date;
    b.refreshPassengers = function() {
        var a = +new Date;
        5E3 > a - localStorage.lastCheckTime || (localStorage.lastCheckTime = a, "true" === window.sessionStorage.getItem("getAllPassengerDisabled") ? (console.warn("here"), window.location = "/otsweb/passengerAction.do?method=initUsualPassenger12306&manual=yes") : TicketPassenger.getAllPassengers(function(a) {
            console.log(a);
            var b = [],
                c = [];
            Utils.getUserInfo(function(d) {
                b = d.passengers || [];
                console.log(b);
                for (d = 0; d < a.length; d++) {
                    var e =
                        a[d],
                        f = !1;
                    e.passenger_id_no = window.hex_md5(e.passenger_id_no);
                    for (var g = 0; g < b.length; g++)
                        if (e.passenger_id_no === b[g].id) {
                            f = b[g].selected;
                            break
                        }
                    c.push({
                        name: e.passenger_name,
                        id: e.passenger_id_no,
                        selected: f
                    })
                }
                console.log(c);
                TicketQuery.updateUserInfo({
                    passengers: c
                }, function() {
                    Utils.sendMessage({
                        type: "refreshPassengers",
                        passengers: c
                    }, function() {})
                })
            })
        }))
    };
    b.studentRefresh = function(a) {
        b.inited && (a ? N(!0) : J())
    };
    b.refresh = function(a) {
        b.inited && (a ? N() : J())
    };
    b.updateUserInfo = function(a, c) {
        b.inited || a.passengers ?
            (a.limitTrain && (a.limitTrain = a.limitTrain.trim()), Utils.getUserInfo(function(b) {
                g = b;
                for (var d in a) a.hasOwnProperty(d) && void 0 !== a[d] && (g[d] = a[d]);
                a.hasOwnProperty("autoLoop") && (C = !0);
                Utils.setUserInfo(g, c)
            })) : c()
    };
    b.initMyOrder = function() {
        var a = $("#queryOrderDTOfrom_order_date"),
            b = $("#queryOrderDTOto_order_date").val(),
            b = t(new Date(+new Date(b) - 2592E6));
        a.val(b);
        $("#submitId")[0].click()
    };
    b.init = function() {
        b.inited = !0;
        Y(function() {
            Utils.sendMessage({
                type: "initQuery"
            }, function() {});
            Utils.sendMessage({
                type: "notify",
                notifyInfo: {
                    method: "cancel",
                    audioPlay: !1,
                    msg: ""
                }
            }, function() {})
        })
    }
})(TicketQuery);
Object.preventExtensions(TicketQuery);
var TicketShare = TicketShare || {};
(function(b) {
    function a(a, b) {
        (new Image).src = "http://dd.browser.360.cn/static/a/" + a + "?_" + Math.random();
        0 !== $(b).length && Utils.sendMessage({
            type: "getServerConfig"
        }, function(a) {
            Utils.sendMessage({
                type: "getInitData"
            }, function(b) {
                var c = b.stype;
                if (void 0 !== c && 0 !== +c) try {
                    $(".help_share_bg").remove();
                    var d = $('<div class="help_share_bg" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.2);background-image: -webkit-gradient(linear, left top, right bottom, color-stop(.25, rgba(255, 255, 255, .15)), color-stop(.25, transparent), color-stop(.5, transparent), color-stop(.5, rgba(255, 255, 255, .15)), color-stop(.75, rgba(255, 255, 255, .15)), color-stop(.75, transparent), to(transparent));-webkit-background-size: 40px 40px;"><div class="help_share_dialog" style="color:#333333;font-size:12px;width:408px;background:#eff2f5;border:#dddddd;position:fixed;top:150px;left:50%;margin-left:-200px;padding:4px;"><div class="help_share_dialog_title_bar" style="background:rgba(49,119,191,1);color:white;height:29px;line-height:29px;text-indent:10px;font-weight:bold;border:1px solid #aed0ea">\u63d0\u793a<a class="help_share_title_close"></a></div><div class="help-share_dialog_content"><div style="padding:18px 45px;line-height:16px;border-bottom:1px solid #dddddd;">' + (a.payfinishShare.content ||
                            '\u606d\u559c\uff0c\u8d2d\u7968\u6210\u529f\uff01<br/>\u8bf7\u70b9\u51fb\u201c<span style="font-weight:bold;color:#27a12d">\u4e70\u5230\u7968\u4e86\uff0c\u5206\u4eab\u5230\u5fae\u535a</span>\u201d\u6309\u94ae<br />\u5c06\u4e70\u5230\u7968\u7684\u6d88\u606f\u5206\u4eab\u7ed9\u60a8\u7684\u597d\u53cb\uff0c\u5e2e\u52a9\u66f4\u591a\u4eba\u4e70\u5230\u706b\u8f66\u7968<p style="margin:10px 0 0;"><a style="color:#27a12d;text-decoration:underline;" href="http://distribute.browser.360.cn?token=bf099cb2f7851934918d596e5bbc4cb6&pid=62&time=1447901777&jumpUrl=aHR0cDovL2UuY2ljLmNuL3dlYi9wb3J0YWwuZG8/dXJsPXNNNXZ0V1dhbnU4RnJabkFheWszN2c9PSZhbXA7cmlza0NvZGU9MTk1MzAwMDA1Mg==" target="_blank">\u5168\u7f51\u72ec\u5bb6\u51fa\u884c\u4fdd\u969c\uff1a3\u5143100\u4e07\u610f\u5916\u9669\u8ba9\u60a8\u5b89\u5fc3\u51fa\u53d1</a></p>') +
                        '</div><div style="color:#fff;position:relative;padding-top:5px; height:37px;"><button class="help_share_submit" style="position:absolute;left:44px;color:#fff;;background:#3f85cd;padding:0 8px;height:30px;cursor:pointer;">' + (a.payfinishShare.shareButtonText || "\u4e70\u5230\u7968\u4e86\uff0c\u5206\u4eab\u5230\u5fae\u535a") + '</button><button class="help_more_url" style="position:absolute;left:225px;color:#fff;cursor:pointer;background:#3f85cd;padding:0 8px;height:30px;" href="' + (a.payfinishShare.moreButtonUrl ||
                            "http://distribute.browser.360.cn?token=ff244741a2708cfd3f9f14409989f45d&pid=62&time=1447904003&jumpUrl=aHR0cDovLzEyMzA2LjM2MC5jbi8/ZnJvbT1xaWFuZ3BpYW9jaGVuZ2dvbmc=") + '">' + (a.payfinishShare.moreButtonText || "\u67e5\u770b\u66f4\u591a\u798f\u5229") + "</button></div><div></div></div></div></div>").appendTo("body");
                    d.find(".help_share_close, .help_share_title_close").click(function(a) {
                        d.remove()
                    }).end().find(".help_more_url").click(function(a) {
                        /^https?:/.test($(this).attr("href")) && window.open($(this).attr("href"),
                            "_blank");
                        d.remove()
                    }).end().find(".help_share_submit").click(function(a) {
                        a = "http://chrome.360.cn/jump/shareticket.html";
                        2 === +c && (a = "http://se.360.cn/jump/shareticket.html");
                        window.open(a, "_blank");
                        d.remove()
                    })
                } catch (t) {}
            })
        })
    }
    b.init = function() {
        a("26.5432.gif", ".succed-big")
    };
    b.initOtn = function() {
        a("26.5642.gif", ".i-success")
    }
})(TicketShare);
Object.preventExtensions(TicketShare);
var TicketTuipiao = TicketTuipiao || {};
(function(b) {
    b.opened = !1;
    b.init = function() {
        $(TicketTuipiao).on("refresh12306Orders", function() {
            $("#querymyorderbutton")[0].click()
        });
        $(TicketTuipiao).on("queryOrderCompleted", function() {
            $("tr .btn92s").each(function() {
                if (!(0 < $(this).parent().find(".btn-px-tuipiao").length || -1 < $(this).parent().prev().text().indexOf("\u6539\u7b7e\u7968"))) {
                    var a = $(this).attr("onclick");
                    (a = a.match(/^returnTrainTicket\((.+?)\)$/)) && a[1] && (a = a[1].replace(/'/g, '"'), a = JSON.parse("[" + a + "]"), a = {
                        query_type: $("select[name=queryType]").val(),
                        start: $("#queryStartDate").val(),
                        end: $("#queryEndDate").val(),
                        sequence_no: a[0],
                        seat_no: a[3]
                    }, a = btoa(JSON.stringify(a)), a = $('<a href="http://pc.huochepiao.360.cn/tuipiao/?' + a + '" target="_blank" class="btn92s btn-px-tuipiao">360\u7701\u94b1\u9000\u7968</a>'), a.on("click", function() {
                        chrome.storage.local.set({
                            "tuipiao-opened": !0
                        })
                    }), $(this).after(a))
                }
            })
        })
    }
})(TicketTuipiao);
var TicketUpdate = TicketUpdate || {};
(function(b) {
    function a(a, b, e) {
        $(".help_share_bg").remove();
        var f = $('<div class="help_share_bg" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.2);background-image: -webkit-gradient(linear, left top, right bottom, color-stop(.25, rgba(255, 255, 255, .15)), color-stop(.25, transparent), color-stop(.5, transparent), color-stop(.5, rgba(255, 255, 255, .15)), color-stop(.75, rgba(255, 255, 255, .15)), color-stop(.75, transparent), to(transparent));-webkit-background-size: 40px 40px;z-index: 999;"><div class="help_share_dialog" style="color:#333333;font-size:12px;width:408px;height:160px;background:#eff2f5;border:#dddddd;position:fixed;top:150px;left:50%;margin-left:-200px;padding:4px;"><div class="help_share_dialog_title_bar" style="background:rgba(49,119,191,1);color:white;height:29px;line-height:29px;text-indent:10px;font-weight:bold;border:1px solid #aed0ea">\u5347\u7ea7\u63d0\u793a</div><div class="help-share_dialog_content"><div style="padding:5px 30px;line-height:16px;border-bottom:1px solid #dddddd;height:65px;">\u201c<span style="font-weight:bold;color:#27a12d">\u62a2\u7968\u738b</span>\u201d\u5df2\u7ecf\u6709\u65b0\u7248\u672c\uff0c\u7248\u672c\u53f7\uff1a<span class="crx_update_version">' + (a ||
            "") + '\uff0c\u662f\u5426\u5347\u7ea7\uff1f</span><br /><span class="crx_update_log"></span></div><div style="color:#fff;position:relative;padding-top:5px;"><button class="help_share_submit" style="position:absolute;left:80px;color:#fff;;background:#3f85cd;width:120px;height:30px;cursor:pointer;">\u7acb\u5373\u5347\u7ea7\uff01</button><button class="help_share_close" style=";position:absolute;left:225px;color:#fff;cursor:pointer;background:#3f85cd;width:80px;height:30px;">\u4e0b\u6b21\u518d\u8bf4</button><p class="update_tips" style="display: none;;position:absolute;top:20px;padding:0;text-align:center;width:100%;margin:0;color:#f00;">\u6b63\u5728\u5347\u7ea7\uff0c\u8bf7\u5728\u7a0d\u540e\u5f39\u51fa\u7684\u5bf9\u8bdd\u6846\u4e2d\u70b9\u51fb\u201c\u6dfb\u52a0\u201d\u5373\u53ef\u5b8c\u6210\u5347\u7ea7\u3002</p></div><div></div></div></div></div>').appendTo("body");
        f.find(".help_share_close").click(function(a) {
            f.remove();
            e && e()
        }).end().find(".help_share_submit").click(function(a) {
            window.open(b, "_blank");
            f.find("button").hide();
            f.find(".update_tips").show()
        })
    }
    b.init = function() {
        console.log(window.location.href);
        if (window.location.href.match(/init|login$/i)) {
            var b = Utils.getHostCtx() + "/order/querySingleAction.do?method=init";
            if (window.parent && window.parent.$) {
                var c = window.parent.$("#username_ a").attr("href");
                if (c && -1 !== c.indexOf("sysuser/user-info")) {
                    window.location.href =
                        b;
                    return
                }
            }
            Utils.sendMessage({
                type: "checkUpdate"
            }, function(b) {
                Utils.updateInfo = b;
                console.log(b);
                b && b.status && a(b.version, b.codebase, null)
            })
        }
    };
    b.initOtn = function() {
        var b = !1; - 1 !== window.location.href.indexOf("/otn/login/init") ? b = !0 : -1 !== window.location.href.indexOf("/otn/leftTicket/init") && $("#login_user").length && ("\u767b\u5f55" === $("#login_user").text() && "string" === typeof $("#login_user").attr("href") && -1 !== $("#login_user").attr("href").indexOf("/otn/login/init")) && (b = !0);
        b && Utils.sendMessage({
                type: "checkUpdate"
            },
            function(b) {
                Utils.updateInfo = b;
                console.log(b);
                b && b.status && a(b.version, b.codebase, null)
            })
    }
})(TicketUpdate);
Object.preventExtensions(TicketUpdate);
var Utils = Utils || {};
(function(b) {
    b.domModify = !0;
    b.updateInfo = {
        version: "2.0.0.1000",
        status: !1,
        codebase: ""
    };
    b.allSeats = "\u5546\u52a1\u5ea7 \u7279\u7b49\u5ea7 \u4e00\u7b49\u5ea7 \u4e8c\u7b49\u5ea7 \u9ad8\u7ea7\u8f6f\u5367 \u8f6f\u5367 \u786c\u5367 \u8f6f\u5ea7 \u786c\u5ea7 \u65e0\u5ea7 \u5176\u4ed6".split(" ");
    b.sendMessage = function(a, d) {
        "function" === typeof chrome.extension.sendMessage ? b.sendMessage = function(a, b) {
            chrome.extension.sendMessage(a, b)
        } : "function" === typeof chrome.extension.sendRequest && (b.sendMessage = function(a,
            b) {
            chrome.extension.sendRequest(a, b)
        });
        b.sendMessage(a, d)
    };
    b.messageAddListener = function() {
        function a(a, c, e) {
            c = a.type;
            switch (c) {
                case "error501":
                    window === window.parent && TicketException.alert_fix("\u6e29\u99a8\u63d0\u793a\uff1a12306\u8bc1\u4e66\u5b89\u88c5\u4e0d\u6b63\u5e38", "12306\u7f51\u7ad9\u901a\u8fc7\u5b89\u5168\u65b9\u5f0f\u8bbf\u95ee\u624d\u80fd\u6b63\u5e38\u4e70\u7968\uff0c\u56e0\u6b64\u9700\u8981\u5b89\u88c5\u94c1\u9053\u90e8\u63d0\u4f9b\u7684\u5b98\u65b9\u8bc1\u4e66\u540e\u624d\u80fd\u6b63\u5e38\u8bbf\u95ee\u3002\u73b0\u5728\u60a8\u5c1a\u672a\u6b63\u786e\u5b89\u88c5\u8bc1\u4e66\uff0c\u8bf7\u70b9\u51fb\u201c\u7acb\u5373\u4fee\u590d\u201d\u5f00\u59cb\u81ea\u52a8\u5b89\u88c5\u8bc1\u4e66\u3002",
                        c);
                    break;
                case "toQuery":
                    setTimeout(function() {
                        var a = $("#menu_left").find("li:eq(0) a");
                        0 < a.length && a.click()
                    }, 1E3 + 500 * Math.random());
                    break;
                case "switchToPathPlan":
                    e = $("cite:eq(6)").parent();
                    0 < e.length && e[0].click();
                    break;
                case "myOrder":
                    TicketQuery.inited && (window.location.href = Utils.getHostCtx() + a.url);
                    break;
                case "removeNotify":
                    TicketQuery.inited && TicketMode.removeNotify(a.stamp);
                    break;
                case "documentCLick":
                    TicketQuery.inited && TicketMode.closeBookNotify();
                    break;
                case "studentRefresh":
                    TicketQuery.inited &&
                        TicketQuery.studentRefresh(a.isStart);
                    break;
                case "refresh":
                    TicketQuery.inited && TicketQuery.refresh(a.isStart);
                    break;
                case "updateUserInfo":
                    TicketQuery.inited && TicketQuery.updateUserInfo(a.info, e);
                    break;
                case "updateServerConfig":
                    console.log(a.config);
                    b.domModify = "true" === (a.config.remarkResult || "false").toString();
                    break;
                case "getFrameOffset":
                    TicketQuery.inited && (a = TicketQuery.getFrameOffset(), console.log("----------------", a), a.success && e(a));
                    break;
                case "order":
                    TicketQuery.inited && TicketQuery.bookTickets(a.trainInfo);
                    break;
                case "refreshPassengers":
                    TicketQuery.inited && TicketQuery.refreshPassengers();
                    break;
                case "addPassenger":
                    TicketQuery.inited && location.replace(Utils.getHostCtx() + "/passengerAction.do?method=initAddPassenger&");
                    break;
                case "onQueryOrderCompleted":
                    $(TicketTuipiao).trigger("queryOrderCompleted");
                    break;
                case "onRefresh12306Orders":
                    $(TicketTuipiao).trigger("refresh12306Orders")
            }
            return !0
        }
        chrome.extension.onMessage && chrome.extension.onMessage.addListener ? chrome.extension.onMessage.addListener(a) : "undefined" !==
            chrome.extension.onRequest && chrome.extension.onRequest.addListener && chrome.extension.onRequest.addListener(a)
    };
    b.getHostCtx = function() {
        var a = "https://dynamic.12306.cn/otsweb";
        window.location && (window.location.protocol && window.location.host) && (a = window.location.protocol + "//" + window.location.host + "/otsweb");
        return a
    };
    b.notify = function(a) {
        b.sendMessage({
            type: "notify",
            info: a
        }, function() {})
    };
    b.route = function(a, b) {
        -1 !== window.location.href.indexOf(a) && b()
    };
    b.xssFilter = function(a) {
        "string" === typeof a && (a =
            a.replace(/&/g, "&amp;"), a = a.replace(/"/g, "&quot;"), a = a.replace(/'/g, "&#039;"), a = a.replace(/</g, "&lt;"), a = a.replace(/>/g, "&gt;"));
        return a
    };
    b.getOffsetTime = function(a) {
        return (a = new Date(a.getResponseHeader("Date"))) ? +new Date - +a : 2
    };
    b.setItem = function(a, b, c) {
        var e = {};
        e[a] = b;
        chrome.storage.local.set(e, c)
    };
    b.getItem = function(a, b) {
        chrome.storage.local.get([a], function(a) {
            b(a)
        })
    };
    b.getUserInfo = function(a) {
        var d = {};
        b.getItem("cur_user_id", function(c) {
            var e = "default_user";
            c.hasOwnProperty("cur_user_id") &&
                (e = c.cur_user_id);
            b.getItem(e, function(b) {
                b.hasOwnProperty(e) && (d = b[e]);
                a(d)
            })
        })
    };
    b.setUserInfo = function(a, d) {
        b.getItem("cur_user_id", function(c) {
            c.hasOwnProperty("cur_user_id") ? b.setItem(c.cur_user_id, a, d) : b.setItem("default_user", a, d)
        })
    };
    b.serverTime = null;
    b.getServerTime = function(a) {
        Utils.serverTime ? a(Utils.serverTime) : $.ajax({
            url: "http://kyfw.12306.cn/otn/resources/images/bg_navlist.png?_" + Math.random(),
            cache: !1,
            data: null,
            timeout: 1E4,
            type: "POST",
            success: function(d, c, e) {
                b.serverTime = +new Date(e.getResponseHeader("Date") ||
                    +new Date);
                a(Utils.serverTime)
            },
            error: function(d, c, e) {
                b.serverTime = +new Date(d.getResponseHeader("Date") || +new Date);
                a(Utils.serverTime)
            }
        })
    };
    b.getScrollBarWidth = function() {
        for (var a = window; a.parent && a !== a.parent;) a = a.parent;
        var b = a.document.body.style.overflow;
        a.document.body.style.overflow = "hidden";
        var c = a.document.body.clientWidth;
        a.document.body.style.overflow = "scroll";
        (c -= a.document.body.clientWidth) || (c = a.document.body.offsetWidth - a.document.body.clientWidth);
        a.document.body.style.overflow = b;
        return 10 <= c && 20 >= c ? c : 17
    };
    b.getTopWindow = function() {
        try {
            return parent === self ? self : parent.window.Passenger.getTopWindow()
        } catch (a) {
            return self
        }
    };
    b.ajax = function(a) {
        b.sendMessage({
            type: "ajax",
            settings: a
        }, function(b) {
            var c = b.data;
            b = b.status;
            if ("json" == a.dataType) try {
                c = JSON.parse(c)
            } catch (e) {}
            0 === b ? "function" == typeof a.success && a.success(c) : "function" == typeof a.error && a.error()
        })
    }
})(Utils);
Object.preventExtensions(Utils);